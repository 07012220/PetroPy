<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>petropy.log &#8212; PetroPy</title>
    <meta property="og:title" content="PetroPy | A Python Petrophysics Package" />
    <meta property="og:description" content="A petrophysics with python package allowing scientific python computing of conventional and unconventional formation evaluation and reservoir characterization. Reads las files and caluclates log properties. Displays data in a customizeable Log Viewer." />
    <meta property="og:url" content="https://toddheitmann.github.io/PetroPy/_modules/petropy/log.html" />
    <meta property="og:image" content="https://www.toddheitmann.com/images/petropy_logo.png"/>
    <meta property="og:type" content="article"/>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../_static/petropy_logo_icon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for petropy.log</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Log contains parent classes to work with log data.</span>

<span class="sd">The Log class is subclassed from lasio LASFile class, which provide a</span>
<span class="sd">data structure. The methods are for petrophysical calculations and for</span>
<span class="sd">viewing data with the LogViewer class.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="k">as</span> <span class="nn">ET</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">nnls</span>

<span class="kn">from</span> <span class="nn">lasio</span> <span class="k">import</span> <span class="n">LASFile</span><span class="p">,</span> <span class="n">CurveItem</span>

<div class="viewcode-block" id="Log"><a class="viewcode-back" href="../../class/Log.html#petropy.Log">[docs]</a><span class="k">class</span> <span class="nc">Log</span><span class="p">(</span><span class="n">LASFile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Log</span>

<span class="sd">    Subclass of LASFile to provide an extension for all petrophysical</span>
<span class="sd">    calculations.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    file_ref : str</span>
<span class="sd">        str path to las file</span>
<span class="sd">    drho_matrix : float (default 2.71)</span>
<span class="sd">        Matrix density for conversion from density porosity to density.</span>
<span class="sd">    kwargs : kwargs</span>
<span class="sd">        Key Word arguements for use with lasio LASFile class.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; import petropy as ptr</span>
<span class="sd">    # define path to las file</span>
<span class="sd">    p = &#39;path/to/well.las&#39;</span>
<span class="sd">    # loads specified las file</span>
<span class="sd">    &gt;&gt;&gt; log = ptr.Log(p)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_ref</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">drho_matrix</span> <span class="o">=</span> <span class="mf">2.71</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">file_ref</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">LASFile</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_ref</span> <span class="o">=</span> <span class="n">file_ref</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">precondition</span><span class="p">(</span><span class="n">drho_matrix</span> <span class="o">=</span> <span class="n">drho_matrix</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fluid_properties_parameters_from_csv</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multimineral_parameters_from_csv</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tops</span> <span class="o">=</span> <span class="p">{}</span>


<div class="viewcode-block" id="Log.precondition"><a class="viewcode-back" href="../../class/Log.html#petropy.Log.precondition">[docs]</a>    <span class="k">def</span> <span class="nf">precondition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drho_matrix</span> <span class="o">=</span> <span class="mf">2.71</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Preconditions log curve by aliasing names.</span>

<span class="sd">        Precondition is used after initializing data and standardizes</span>
<span class="sd">        names for future calculations.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        drho_matrix : float, optional</span>
<span class="sd">            drho_matrix is for converting density porosity to bulk</span>
<span class="sd">            densty, and is only used when bulk density is missing.</span>
<span class="sd">            Default value for limestone matrix. If log was run on</span>
<span class="sd">            sandstone matrix, use 2.65. If log was run on dolomite</span>
<span class="sd">            matrix, use 2.85.</span>

<span class="sd">        Note</span>
<span class="sd">        -----</span>
<span class="sd">            1. Curve Alias is provided by the curve_alias.xml file</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">file_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
        <span class="n">ALIAS_XML_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">file_dir</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span>
                                      <span class="s1">&#39;curve_alias.xml&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">ALIAS_XML_PATH</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Could not find alias xml at: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> \
                             <span class="n">ALIAS_XML_PATH</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ALIAS_XML_PATH</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">curve</span> <span class="ow">in</span> <span class="n">alias</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">curve</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">alias</span><span class="o">.</span><span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">curve_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curves</span><span class="p">[</span><span class="n">curve</span><span class="o">.</span><span class="n">tag</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">add_curve</span><span class="p">(</span><span class="n">alias</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="n">curve</span><span class="o">.</span><span class="n">tag</span><span class="p">],</span>
                                       <span class="n">unit</span> <span class="o">=</span> <span class="n">curve_item</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span>
                                       <span class="n">value</span> <span class="o">=</span> <span class="n">curve_item</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                       <span class="n">descr</span> <span class="o">=</span> <span class="n">curve_item</span><span class="o">.</span><span class="n">descr</span><span class="p">)</span>
                    <span class="k">break</span>

        <span class="k">if</span> <span class="s1">&#39;RHOB_N&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;DPHI_N&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">calculated_rho</span><span class="o">=</span> <span class="n">drho_matrix</span><span class="o">-</span><span class="p">(</span><span class="n">drho_matrix</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;DHI_N&#39;</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_curve</span><span class="p">(</span><span class="s1">&#39;RHOB_N&#39;</span><span class="p">,</span> <span class="n">calculated_rho</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;g/cc&#39;</span><span class="p">,</span>
                       <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                       <span class="n">descr</span> <span class="o">=</span> <span class="s1">&#39;Calculated bulk density from density </span><span class="se">\</span>
<span class="s1">                               porosity assuming rho matrix = </span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> \
                               <span class="n">drho_matrix</span><span class="p">)</span></div>

<div class="viewcode-block" id="Log.tops_from_csv"><a class="viewcode-back" href="../../class/Log.html#petropy.Log.tops_from_csv">[docs]</a>    <span class="k">def</span> <span class="nf">tops_from_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">csv_path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads tops from a csv file and saves as dictionary.</span>

<span class="sd">        Here is a sample csv file with default tops_ data.</span>

<span class="sd">        .. _tops: ../_static/tops.csv</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        csv_path : str (default None)</span>
<span class="sd">            Path to csv file to read. Must contain header row the the</span>
<span class="sd">            following properties:</span>
<span class="sd">            ::</span>

<span class="sd">                uwi : str</span>
<span class="sd">                    Unique Well Identifier</span>
<span class="sd">                form : str</span>
<span class="sd">                    Name of formation top</span>
<span class="sd">                depth : float</span>
<span class="sd">                    depth of corresponding formation top</span>

<span class="sd">        Note</span>
<span class="sd">        -----</span>
<span class="sd">        Format for csv:</span>
<span class="sd">        ::</span>

<span class="sd">            uwi,form,depth</span>
<span class="sd">            11111111111,WFMPA,7000.50</span>
<span class="sd">            11111111111,WFMPB,7250.50</span>
<span class="sd">            11111111111,WFMPC,7500.00</span>
<span class="sd">            11111111111,WFMPD,7700.25</span>
<span class="sd">            11111111111,DEAN,8000.00</span>

<span class="sd">        Example</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import petropy as ptr</span>
<span class="sd">        # define path to las file</span>
<span class="sd">        p = &#39;path/to/well.las&#39;</span>
<span class="sd">        # loads specified las file</span>
<span class="sd">        &gt;&gt;&gt; log = ptr.Log(p)</span>
<span class="sd">        # define path to csv tops file</span>
<span class="sd">        &gt;&gt;&gt; t = &#39;path/to/tops.csv&#39;</span>
<span class="sd">        # loads specified tops csv</span>
<span class="sd">        &gt;&gt;&gt; log.tops_from_csv(t)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">csv_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">local_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
            <span class="n">csv_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;tops.csv&#39;</span><span class="p">)</span>

        <span class="n">top_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;uwi&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                                <span class="s1">&#39;depth&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">})</span>

        <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">top_df</span><span class="p">[</span><span class="n">top_df</span><span class="o">.</span><span class="n">uwi</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">well</span><span class="p">[</span><span class="s1">&#39;UWI&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span>\
        <span class="n">iterrows</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tops</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">form</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">depth</span></div>


<div class="viewcode-block" id="Log.next_formation_depth"><a class="viewcode-back" href="../../class/Log.html#petropy.Log.next_formation_depth">[docs]</a>    <span class="k">def</span> <span class="nf">next_formation_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formation</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return top of formation below specified formation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        formation : str</span>
<span class="sd">            name of formation which should be found in preloaded tops</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bottom : float</span>
<span class="sd">            top of formation below input formation, acting as bottom of</span>
<span class="sd">            input formation</span>

<span class="sd">        Example</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import petropy as ptr</span>
<span class="sd">        # reads sample Wolfcamp Log from las file</span>
<span class="sd">        &gt;&gt;&gt; log = ptr.log_data(&#39;WFMP&#39;)</span>
<span class="sd">        # get top of formation WFMPA</span>
<span class="sd">        &gt;&gt;&gt; wfmpa_top = log.tops[&#39;WFMPA&#39;]</span>
<span class="sd">        &gt;&gt;&gt; print(wfmpa_top)</span>
<span class="sd">        6993.5</span>
<span class="sd">        # got bottom of formation WFMPA</span>
<span class="sd">        &gt;&gt;&gt; wfmpa_bottom = log.next_formation_depth(&#39;WFMPB&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(wfmpa_bottom)</span>
<span class="sd">        7294.0</span>
<span class="sd">        # Compare depths for bottom of WFMPA</span>
<span class="sd">        # to top of WFMPB</span>
<span class="sd">        &gt;&gt;&gt; wfmpb_top = log.tops[&#39;WFMPB&#39;]</span>
<span class="sd">        &gt;&gt;&gt; print(wfmpb_top)</span>
<span class="sd">        7294.0</span>
<span class="sd">        &gt;&gt;&gt; print(wfmpa_bottom == wfmpb_top)</span>
<span class="sd">        True</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tops</span><span class="p">[</span><span class="n">formation</span><span class="p">]</span>

        <span class="n">bottom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">closest_formation</span> <span class="o">=</span> <span class="n">bottom</span> <span class="o">-</span> <span class="n">top</span>
        <span class="k">for</span> <span class="n">form</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tops</span><span class="p">:</span>
            <span class="n">form_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tops</span><span class="p">[</span><span class="n">form</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">form_depth</span> <span class="o">&gt;</span> <span class="n">top</span> <span class="ow">and</span> <span class="n">form_depth</span> <span class="o">-</span> <span class="n">top</span><span class="o">&lt;</span><span class="n">closest_formation</span><span class="p">:</span>
                <span class="n">bottom</span> <span class="o">=</span> <span class="n">form_depth</span>
                <span class="n">closest_formation</span> <span class="o">=</span> <span class="n">bottom</span> <span class="o">-</span> <span class="n">top</span>

        <span class="k">return</span> <span class="n">bottom</span></div>


<div class="viewcode-block" id="Log.fluid_properties_parameters_from_csv"><a class="viewcode-back" href="../../class/Log.html#petropy.Log.fluid_properties_parameters_from_csv">[docs]</a>    <span class="k">def</span> <span class="nf">fluid_properties_parameters_from_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">csv_path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads parameters from a csv for input into fluid properties.</span>

<span class="sd">        This method reads the file located at the csv_path and turns the</span>
<span class="sd">        values into dictionaries to be used as inputs into the</span>
<span class="sd">        fluid_properties method.</span>

<span class="sd">        This reference_ is a sample csv file with default data for</span>
<span class="sd">        fluid properties.</span>

<span class="sd">        .. _reference: ../_static/fluid_properties_parameters.csv</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        csv_path : str (default None)</span>


<span class="sd">        Note</span>
<span class="sd">        -----</span>
<span class="sd">        Path to csv file to read. Must contain header row with the</span>
<span class="sd">        following properties</span>

<span class="sd">            mast : float (default 67)</span>
<span class="sd">                The mean annual surface temperature at the location of</span>
<span class="sd">                the well in degrees Fahrenheit.</span>
<span class="sd">            temp_grad : float (default 0.015)</span>
<span class="sd">                The temperature gradient of the reservoir in °F / ft.</span>
<span class="sd">            press_grad : float (default 0.5)</span>
<span class="sd">                The pressure gradient of the reservoir in psi / ft.</span>
<span class="sd">            rws : float (default 0.1)</span>
<span class="sd">                The resistivity of water at surface conditions in ohm.m</span>
<span class="sd">            rwt : float (default 70)</span>
<span class="sd">                The temperature of the rws measurement in °F.</span>
<span class="sd">            rmfs : float (default 0.4)</span>
<span class="sd">                The resistivity of mud fultrate at surface conditions</span>
<span class="sd">                in ohm.m</span>
<span class="sd">            rmft : float (default 100)</span>
<span class="sd">                The temperature of the rmfs measurement in °F.</span>
<span class="sd">            gas_grav : float (default 0.67)</span>
<span class="sd">                The specific gravity of the separator gas. Air = 1,</span>
<span class="sd">                CH4 = 0.577</span>
<span class="sd">            oil_api : float (default 38)</span>
<span class="sd">                The api gravity of oil after the separator. If fluid</span>
<span class="sd">                system is dry gas, use :code:`oil_api = 0`.</span>
<span class="sd">            p_sep : float (default 100)</span>
<span class="sd">                The pressure of the separator, assuming a 2 stage</span>
<span class="sd">                system. Only used when :code:`oil_api` is &gt; 0</span>
<span class="sd">                (not dry gas).</span>
<span class="sd">            t_sep : float</span>
<span class="sd">                The temperature of the separator , assuming a 2 stage</span>
<span class="sd">                system. Only used with :code:`oil_api &gt; 0`.</span>
<span class="sd">            yn2 : float (default 0)</span>
<span class="sd">                Molar fraction of nitrogren in gas.</span>
<span class="sd">            yco2 : float (default 0)</span>
<span class="sd">                Molar fration of carbon dioxide in gas.</span>
<span class="sd">            yh2s : float (default 0)</span>
<span class="sd">                Molar fraction of hydrogen sulfide in gas.</span>
<span class="sd">            yh20 : float (default 0)</span>
<span class="sd">                Molar fraction of water in gas.</span>
<span class="sd">            rs : float (default 0)</span>
<span class="sd">                Solution gas oil ratio at reservoir conditions.</span>
<span class="sd">                If unknwon, use 0 and correlation will be calculated.</span>
<span class="sd">            lith_grad : float (default 1.03)</span>
<span class="sd">                Lithostatic gradient in psi / ft.</span>
<span class="sd">            biot : float (default 0.8)</span>
<span class="sd">                Biot constant.</span>
<span class="sd">            pr : float (default 0.25)</span>
<span class="sd">                Poissons ratio</span>



<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import petropy as ptr</span>
<span class="sd">        # reads sample Wolfcamp Log from las file</span>
<span class="sd">        &gt;&gt;&gt; log = ptr.log_data(&#39;WFMP&#39;)</span>
<span class="sd">        # loads sample parameters provided</span>
<span class="sd">        &gt;&gt;&gt; log.fluid_properties_parameters_from_csv()</span>

<span class="sd">        &gt;&gt;&gt; import petropy as ptr</span>
<span class="sd">        # reads sample Wolfcamp Log from las file</span>
<span class="sd">        &gt;&gt;&gt; log = ptr.log_data(&#39;WFMP&#39;)</span>
<span class="sd">        # define path to csv file with parameters</span>
<span class="sd">        &gt;&gt;&gt; my_csv_paramters = &#39;path/to/csv/file.csv&#39;</span>
<span class="sd">        # loads specified parameters</span>
<span class="sd">        &gt;&gt;&gt; log.fluid_properties_parameters_from_csv(my_csv_paramters)</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`petropy.Log.fluid_properties`</span>
<span class="sd">            Calculates fluid properties using input settings loaded</span>
<span class="sd">            through this method</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">csv_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">local_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
            <span class="n">csv_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;fluid_properties_parameters.csv&#39;</span><span class="p">)</span>

        <span class="n">param_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span>
        <span class="n">param_df</span> <span class="o">=</span> <span class="n">param_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fluid_properties_parameters</span> <span class="o">=</span> \
                                     <span class="n">param_df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span> <span class="o">=</span> <span class="s1">&#39;index&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Log.fluid_properties"><a class="viewcode-back" href="../../class/Log.html#petropy.Log.fluid_properties">[docs]</a>    <span class="k">def</span> <span class="nf">fluid_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">,</span> <span class="n">mast</span> <span class="o">=</span> <span class="mi">67</span><span class="p">,</span>
    <span class="n">temp_grad</span> <span class="o">=</span> <span class="mf">0.015</span><span class="p">,</span> <span class="n">press_grad</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">rws</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">rwt</span> <span class="o">=</span> <span class="mi">70</span><span class="p">,</span>
    <span class="n">rmfs</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">rmft</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">gas_grav</span> <span class="o">=</span> <span class="mf">0.67</span><span class="p">,</span> <span class="n">oil_api</span> <span class="o">=</span> <span class="mi">38</span><span class="p">,</span> <span class="n">p_sep</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="n">t_sep</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">yn2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">yco2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">yh2s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">yh20</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">lith_grad</span> <span class="o">=</span> <span class="mf">1.03</span><span class="p">,</span> <span class="n">biot</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">pr</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates fluid properties along wellbore.</span>

<span class="sd">        The output add the following calculated curves at each depth:</span>

<span class="sd">        PORE_PRESS : (psi)</span>
<span class="sd">            Reservoir pore pressure</span>
<span class="sd">        RES_TEMP : (°F)</span>
<span class="sd">            Reservoir temperature</span>
<span class="sd">        NES : (psi)</span>
<span class="sd">            Reservoir net effective stress</span>
<span class="sd">        RW : (ohm.m)</span>
<span class="sd">            Resistivity of water</span>
<span class="sd">        RMF : (ohm.m)</span>
<span class="sd">            Resistivity of mud filtrate</span>
<span class="sd">        RHO_HC : (g / cc)</span>
<span class="sd">            Density of hydrocarbon</span>
<span class="sd">        RHO_W : (g / cc)</span>
<span class="sd">            Density of formation water</span>
<span class="sd">        RHO_MF : (g / cc)</span>
<span class="sd">            Density of mud filtrate</span>
<span class="sd">        NPHI_HC</span>
<span class="sd">            Neutron log response of hydrocarbon</span>
<span class="sd">        NPHI_W</span>
<span class="sd">            Neutron log response of water</span>
<span class="sd">        NPHI_MF</span>
<span class="sd">            Neutron log response of mud filtrate</span>
<span class="sd">        MU_HC : (cP)</span>
<span class="sd">            Viscosity of hydrocarbon</span>
<span class="sd">        Z</span>
<span class="sd">            Compressiblity factor for non-ideal gas.</span>
<span class="sd">            Only output if oil_api = 0</span>
<span class="sd">        CG : (1 / psi)</span>
<span class="sd">            Gas Compressiblity. Only output if oil_api = 0</span>
<span class="sd">        BG</span>
<span class="sd">            Gas formation volume factor. Only output if oil_api = 0</span>
<span class="sd">        BP : (psi)</span>
<span class="sd">            Bubble point. Only output if oil_api &gt; 0</span>
<span class="sd">        BO</span>
<span class="sd">            Oil formation volume factor. Only output if oil_api &gt; 0</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        top : float (default 0)</span>
<span class="sd">            The top depth to begin fluid properties calculation. If</span>
<span class="sd">            value is not specified, the calculations will start at</span>
<span class="sd">            the top of the log.</span>
<span class="sd">        bottom : float (default 100,000)</span>
<span class="sd">            The bottom depth to end fluid properties, inclusive. If the</span>
<span class="sd">            value is not specified, the calcuations will go to the</span>
<span class="sd">            end of the log.</span>
<span class="sd">        mast : float (default 67)</span>
<span class="sd">            The mean annual surface temperature at the location of the</span>
<span class="sd">            well in degrees Fahrenheit.</span>
<span class="sd">        temp_grad : float (default 0.015)</span>
<span class="sd">            The temperature gradient of the reservoir in °F / ft.</span>
<span class="sd">        press_grad : float (default 0.5)</span>
<span class="sd">            The pressure gradient of the reservoir in psi / ft.</span>
<span class="sd">        rws : float (default 0.1)</span>
<span class="sd">            The resistivity of water at surface conditions in ohm.m.</span>
<span class="sd">        rwt : float (default 70)</span>
<span class="sd">            The temperature of the rws measurement in °F.</span>
<span class="sd">        rmfs : float (default 0.4)</span>
<span class="sd">            The resistivity of mud fultrate at surface conditions in</span>
<span class="sd">            ohm.m</span>
<span class="sd">        rmft : float (default 100)</span>
<span class="sd">            The temperature of the rmfs measurement in °F</span>
<span class="sd">        gas_grav : float (default 0.67)</span>
<span class="sd">            The specific gravity of the separator gas. Air = 1,</span>
<span class="sd">            CH4 = 0.577</span>
<span class="sd">        oil_api : float (default 38)</span>
<span class="sd">            The api gravity of oil after the separator</span>
<span class="sd">            If fluid system is dry gas, use oil_api = 0.</span>
<span class="sd">        p_sep : float (default 100)</span>
<span class="sd">            The pressure of the separator, assuming a 2 stage system</span>
<span class="sd">            Only used when oil_api is &gt; 0 (not dry gas).</span>
<span class="sd">        t_sep : float</span>
<span class="sd">            The temperature of the separator, assuming a 2 stage system</span>
<span class="sd">            Only used with :code:`oil_api &gt; 0`.</span>
<span class="sd">        yn2 : float (default 0)</span>
<span class="sd">            Molar fraction of nitrogren in gas.</span>
<span class="sd">        yco2 : float (default 0)</span>
<span class="sd">            Molar fration of carbon dioxide in gas.</span>
<span class="sd">        yh2s : float (default 0)</span>
<span class="sd">            Molar fraction of hydrogen sulfide in gas.</span>
<span class="sd">        yh20 : float (default 0)</span>
<span class="sd">            Molar fraction of water in gas.</span>
<span class="sd">        rs : float (default 0)</span>
<span class="sd">            Solution gas oil ratio at reservoir conditions.</span>
<span class="sd">            If unknwon, use 0 and correlation will be used.</span>
<span class="sd">        lith_grad : float (default 1.03)</span>
<span class="sd">            Lithostatic overburden pressure gradient in psi / ft.</span>
<span class="sd">        biot : float (default 0.8)</span>
<span class="sd">            Biot constant.</span>
<span class="sd">        pr : float (default 0.25)</span>
<span class="sd">            Poissons ratio</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        Current single phase fluid properties assumes either:</span>

<span class="sd">            1. Dry Gas at Reservoir Conditions</span>
<span class="sd">            Methane as hydrocarbon type with options to include N2,</span>
<span class="sd">            CO2, H2S, or H2O. To assume dry_gas, set</span>
<span class="sd">            :code:`oil_api = 0`</span>

<span class="sd">            2. Oil at Reservoir Conditions</span>
<span class="sd">            Assumes reservoir fluids are either a black or volatile</span>
<span class="sd">            oil. Separator conditions of gas are used to calculate</span>
<span class="sd">            bubble point and the reservoir fluid properties of the</span>
<span class="sd">            reconstituted oil.</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        Ahmed, Tarek H. Reservoir Engineering Handbook. Oxford: Gulf</span>
<span class="sd">            Professional, 2006.</span>

<span class="sd">        Lee, John, and Robert A. Wattenbarger. Gas Reservoir</span>
<span class="sd">            Engineering. Richardson, TX: Henry L. Doherty Memorial</span>
<span class="sd">            Fund of AIME, Society of Petroleum Engineers, 2008.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import petropy as ptr</span>
<span class="sd">        &gt;&gt;&gt; from petropy import datasets</span>
<span class="sd">        # reads sample Wolfcamp Log from las file</span>
<span class="sd">        &gt;&gt;&gt; log = ptr.log_data(&#39;WFMP&#39;)</span>
<span class="sd">        # calculates fluid properties with default settings</span>
<span class="sd">        &gt;&gt;&gt; log.fluid_properties()</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`petropy.Log.fluid_properties_parameters_from_csv`</span>
<span class="sd">            loads properties from preconfigured csv file</span>
<span class="sd">        :meth:`petropy.Log.multimineral_model`</span>
<span class="sd">            builds on fluid properties to calculate full petrophysical</span>
<span class="sd">            model</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">### fluid property calculations ###</span>

        <span class="n">depth_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">top</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bottom</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">depths</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">depth_index</span><span class="p">]</span>

        <span class="n">form_temp</span> <span class="o">=</span> <span class="n">mast</span> <span class="o">+</span> <span class="n">temp_grad</span> <span class="o">*</span> <span class="n">depths</span>
        <span class="n">pore_press</span> <span class="o">=</span> <span class="n">press_grad</span> <span class="o">*</span> <span class="n">depths</span>

        <span class="c1">### water properties ###</span>
        <span class="n">rw</span> <span class="o">=</span> <span class="p">(</span><span class="n">rwt</span> <span class="o">+</span> <span class="mf">6.77</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">form_temp</span> <span class="o">+</span> <span class="mf">6.77</span><span class="p">)</span> <span class="o">*</span> <span class="n">rws</span>
        <span class="n">rmf</span> <span class="o">=</span> <span class="p">(</span><span class="n">rmft</span> <span class="o">+</span> <span class="mf">6.77</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">form_temp</span> <span class="o">+</span> <span class="mf">6.77</span><span class="p">)</span> <span class="o">*</span> <span class="n">rmfs</span>

        <span class="n">rw68</span> <span class="o">=</span> <span class="p">(</span><span class="n">rwt</span> <span class="o">+</span> <span class="mf">6.77</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">68</span> <span class="o">+</span> <span class="mf">6.77</span><span class="p">)</span> <span class="o">*</span> <span class="n">rws</span>
        <span class="n">rmf68</span> <span class="o">=</span> <span class="p">(</span><span class="n">rmft</span> <span class="o">+</span> <span class="mf">6.77</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">68</span> <span class="o">+</span> <span class="mf">6.77</span><span class="p">)</span> <span class="o">*</span> <span class="n">rws</span>

        <span class="c1">### weight percent total disolved solids ###</span>
        <span class="n">xsaltw</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5268</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">rw68</span><span class="p">)</span> <span class="p">)</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">-</span> <span class="mf">1.0199</span> <span class="o">*</span> \
            <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">rw68</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mf">1.6693</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">rw68</span><span class="p">))</span> <span class="o">-</span> <span class="mf">0.3087</span><span class="p">)</span>
        <span class="n">xsaltmf</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5268</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">rmf68</span><span class="p">)</span> <span class="p">)</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">-</span> <span class="mf">1.0199</span> <span class="o">*</span> \
          <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">rmf68</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mf">1.6693</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">rmf68</span><span class="p">))</span> <span class="o">-</span> <span class="mf">0.3087</span><span class="p">)</span>

        <span class="c1">### bw for reservoir water. ###</span>
        <span class="c1">### Eq 1.83 - 1.85 Gas Reservoir Engineering ###</span>
        <span class="n">dvwt</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0001</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">1.33391</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">4</span> <span class="o">*</span> <span class="n">form_temp</span> <span class="o">+</span> \
                <span class="mf">5.50654</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">7</span> <span class="o">*</span> <span class="n">form_temp</span> <span class="o">**</span> <span class="mi">2</span>

        <span class="n">dvwp</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.95301</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">9</span> <span class="o">*</span> <span class="n">pore_press</span> <span class="o">*</span> <span class="n">form_temp</span> <span class="o">-</span> \
                <span class="mf">1.72834</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">13</span> <span class="o">*</span> <span class="n">pore_press</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">form_temp</span> <span class="o">-</span> \
                <span class="mf">3.58922</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">7</span> <span class="o">*</span> <span class="n">pore_press</span> <span class="o">-</span> \
                <span class="mf">2.25341</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">10</span> <span class="o">*</span> <span class="n">pore_press</span> <span class="o">**</span> <span class="mi">2</span>

        <span class="n">bw</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">dvwt</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">dvwp</span><span class="p">)</span>

        <span class="c1">### calculate solution gas in water ratio ###</span>
        <span class="c1">### Eq. 1.86 - 1.91 Gas Reservoir Engineering ###</span>
        <span class="n">rsa</span> <span class="o">=</span> <span class="mf">8.15839</span> <span class="o">-</span> <span class="mf">6.12265</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">form_temp</span> <span class="o">+</span> \
                                <span class="mf">1.91663</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">4</span> <span class="o">*</span> <span class="n">form_temp</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> \
                                <span class="mf">2.1654</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">7</span> <span class="o">*</span> <span class="n">form_temp</span> <span class="o">**</span> <span class="mi">3</span>

        <span class="n">rsb</span> <span class="o">=</span> <span class="mf">1.01021</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">7.44241</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">5</span> <span class="o">*</span> <span class="n">form_temp</span> <span class="o">+</span> \
                                <span class="mf">3.05553</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">7</span> <span class="o">*</span> <span class="n">form_temp</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> \
                                <span class="mf">2.94883</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">10</span> <span class="o">*</span> <span class="n">form_temp</span> <span class="o">**</span> <span class="mi">3</span>

        <span class="n">rsc</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">7</span> <span class="o">*</span> <span class="p">(</span><span class="mf">9.02505</span> <span class="o">-</span> <span class="mf">0.130237</span> <span class="o">*</span> <span class="n">form_temp</span> <span class="o">+</span> \
           <span class="mf">8.53425</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">4</span> <span class="o">*</span> <span class="n">form_temp</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mf">2.34122</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">6</span> <span class="o">*</span> \
           <span class="n">form_temp</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">+</span> <span class="mf">2.37049</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">9</span> <span class="o">*</span> <span class="n">form_temp</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span>

        <span class="n">rswp</span> <span class="o">=</span> <span class="n">rsa</span> <span class="o">+</span> <span class="n">rsb</span> <span class="o">*</span> <span class="n">pore_press</span> <span class="o">+</span> <span class="n">rsc</span> <span class="o">*</span> <span class="n">pore_press</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">rsw</span> <span class="o">=</span> <span class="n">rswp</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">0.0840655</span> <span class="o">*</span> <span class="n">xsaltw</span> <span class="o">*</span> <span class="n">form_temp</span> <span class="o">**</span> <span class="o">-</span><span class="mf">0.285584</span><span class="p">)</span>

        <span class="c1">### log responses ###</span>
        <span class="n">rho_w</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.7512</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">5</span> <span class="o">*</span> <span class="n">xsaltw</span> <span class="o">+</span> \
                 <span class="mf">6.9159</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="n">xsaltw</span> <span class="o">+</span> <span class="mf">1.0005</span><span class="p">)</span> <span class="o">*</span> <span class="n">bw</span>

        <span class="n">rho_mf</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.7512</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">5</span> <span class="o">*</span> <span class="n">xsaltmf</span> <span class="o">+</span> \
                  <span class="mf">6.9159</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="n">xsaltmf</span> <span class="o">+</span> <span class="mf">1.0005</span><span class="p">)</span> <span class="o">*</span> <span class="n">bw</span>

        <span class="n">nphi_w</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="p">(</span><span class="n">xsaltw</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">nphi_mf</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="p">(</span><span class="n">xsaltmf</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>

        <span class="c1">### net efective stress ###</span>
        <span class="n">nes</span> <span class="o">=</span> <span class="p">(((</span><span class="n">lith_grad</span> <span class="o">*</span> <span class="n">depths</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">biot</span> <span class="o">*</span> <span class="n">press_grad</span> <span class="o">*</span> <span class="n">depths</span><span class="p">)</span> <span class="o">+</span> \
                 <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">pr</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">pr</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">lith_grad</span> <span class="o">*</span> <span class="n">depths</span><span class="p">)</span> <span class="o">-</span> \
                 <span class="p">(</span><span class="n">biot</span> <span class="o">*</span> <span class="n">press_grad</span> <span class="o">*</span> <span class="n">depths</span><span class="p">)))</span> <span class="o">/</span> <span class="mi">3</span>

        <span class="c1">### gas reservoir ###</span>
        <span class="k">if</span> <span class="n">oil_api</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># hydrocarbon garvity only</span>
            <span class="n">hc_grav</span> <span class="o">=</span> <span class="p">(</span><span class="n">gas_grav</span> <span class="o">-</span> <span class="mf">1.1767</span> <span class="o">*</span> <span class="n">yh2s</span> <span class="o">-</span> <span class="mf">1.5196</span> <span class="o">*</span> <span class="n">yco2</span> <span class="o">-</span> \
                       <span class="mf">0.9672</span> <span class="o">*</span> <span class="n">yn2</span> <span class="o">-</span> <span class="mf">0.622</span> <span class="o">*</span> <span class="n">yh20</span><span class="p">)</span> <span class="o">/</span> \
                       <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">yn2</span> <span class="o">-</span> <span class="n">yco2</span> <span class="o">-</span> <span class="n">yh20</span> <span class="o">-</span> <span class="n">yh2s</span><span class="p">)</span>

            <span class="c1"># pseudocritical properties of hydrocarbon</span>
            <span class="n">ppc_h</span> <span class="o">=</span> <span class="mf">756.8</span> <span class="o">-</span> <span class="mf">131.0</span> <span class="o">*</span> <span class="n">hc_grav</span> <span class="o">-</span> <span class="mf">3.6</span> <span class="o">*</span> <span class="p">(</span><span class="n">hc_grav</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">tpc_h</span> <span class="o">=</span> <span class="mf">169.2</span> <span class="o">+</span> <span class="mf">349.5</span> <span class="o">*</span> <span class="n">hc_grav</span> <span class="o">-</span> <span class="mf">74.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">hc_grav</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

            <span class="c1"># pseudocritical properties of mixture</span>
            <span class="n">ppc</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">yh2s</span> <span class="o">-</span> <span class="n">yco2</span> <span class="o">-</span> <span class="n">yn2</span> <span class="o">-</span> <span class="n">yh20</span><span class="p">)</span> <span class="o">*</span> <span class="n">ppc_h</span> <span class="o">+</span> \
                  <span class="mf">1306.0</span> <span class="o">*</span> <span class="n">yh2s</span> <span class="o">+</span> <span class="mf">1071.0</span> <span class="o">*</span> <span class="n">yco2</span> <span class="o">+</span> \
                  <span class="mf">493.1</span> <span class="o">*</span> <span class="n">yn2</span> <span class="o">+</span> <span class="mf">3200.1</span> <span class="o">*</span> <span class="n">yh20</span>

            <span class="n">tpc</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">yh2s</span> <span class="o">-</span> <span class="n">yco2</span> <span class="o">-</span> <span class="n">yn2</span> <span class="o">-</span> <span class="n">yh20</span><span class="p">)</span> <span class="o">*</span> <span class="n">tpc_h</span> <span class="o">+</span> \
                  <span class="mf">672.35</span> <span class="o">*</span> <span class="n">yh2s</span> <span class="o">+</span> <span class="mf">547.58</span> <span class="o">*</span> <span class="n">yco2</span> <span class="o">+</span> \
                  <span class="mf">227.16</span> <span class="o">*</span> <span class="n">yn2</span> <span class="o">+</span> <span class="mf">1164.9</span> <span class="o">*</span> <span class="n">yh20</span>

            <span class="c1"># Wichert-Aziz correction for H2S and CO2</span>
            <span class="k">if</span> <span class="n">yco2</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">yh2s</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">epsilon</span> <span class="o">=</span> <span class="mi">120</span> <span class="o">*</span> <span class="p">((</span><span class="n">yco2</span> <span class="o">+</span> <span class="n">yh2s</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.9</span> <span class="o">-</span> \
                          <span class="p">(</span><span class="n">yco2</span> <span class="o">+</span> <span class="n">yh2s</span><span class="p">)</span> <span class="o">**</span> <span class="mf">1.6</span><span class="p">)</span> <span class="o">+</span> \
                          <span class="mi">15</span> <span class="o">*</span> <span class="p">(</span><span class="n">yh2s</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="o">-</span> <span class="n">yh2s</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span>

                <span class="n">tpc_temp</span> <span class="o">=</span> <span class="n">tpc</span> <span class="o">-</span> <span class="n">epsilon</span>
                <span class="n">ppc</span> <span class="o">=</span> <span class="p">(</span><span class="n">ppc_a</span> <span class="o">*</span> <span class="n">tpc_temp</span><span class="p">)</span> <span class="o">/</span> \
                      <span class="p">(</span><span class="n">tpc</span> <span class="o">+</span> <span class="p">(</span><span class="n">yh2s</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">yh2s</span><span class="p">)</span> <span class="o">*</span> <span class="n">epsilon</span><span class="p">))</span>

                <span class="n">tpc</span> <span class="o">=</span> <span class="n">tpc_temp</span>
            <span class="c1"># Casey correction for nitrogen and water vapor</span>
            <span class="k">if</span> <span class="n">yn2</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">yh20</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">tpc_cor</span> <span class="o">=</span> <span class="o">-</span><span class="mf">246.1</span> <span class="o">*</span> <span class="n">yn2</span> <span class="o">+</span> <span class="mi">400</span> <span class="o">*</span> <span class="n">yh20</span>
                <span class="n">ppc_cor</span> <span class="o">=</span> <span class="o">-</span><span class="mf">162.0</span> <span class="o">*</span> <span class="n">yn2</span> <span class="o">+</span> <span class="mf">1270.0</span> <span class="o">*</span> <span class="n">yh20</span>
                <span class="n">tpc</span> <span class="o">=</span> <span class="p">(</span><span class="n">tpc</span> <span class="o">-</span> <span class="mf">227.2</span> <span class="o">*</span> <span class="n">yn2</span> <span class="o">-</span> <span class="mf">1165.0</span> <span class="o">*</span> <span class="n">yh20</span><span class="p">)</span> <span class="o">/</span> \
                      <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">yn2</span> <span class="o">-</span> <span class="n">yh20</span><span class="p">)</span> <span class="o">+</span> <span class="n">tpc_cor</span>

                <span class="n">ppc</span> <span class="o">=</span> <span class="p">(</span><span class="n">ppc</span> <span class="o">-</span> <span class="mf">493.1</span> <span class="o">*</span> <span class="n">yn2</span> <span class="o">-</span> <span class="mf">3200.0</span> <span class="o">*</span> <span class="n">yH20</span><span class="p">)</span> <span class="o">/</span> \
                      <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">yn2</span> <span class="o">-</span> <span class="n">yh20</span><span class="p">)</span> <span class="o">+</span> <span class="n">ppc_cor</span>

            <span class="c1"># Reduced pseudocritical properties</span>
            <span class="n">tpr</span> <span class="o">=</span> <span class="p">(</span><span class="n">form_temp</span> <span class="o">+</span> <span class="mf">459.67</span><span class="p">)</span> <span class="o">/</span> <span class="n">tpc</span>
            <span class="n">ppr</span> <span class="o">=</span> <span class="n">pore_press</span> <span class="o">/</span> <span class="n">ppc</span>

            <span class="c1">### z factor from Dranchuk and Abou-Kassem fit of ###</span>
            <span class="c1">### Standing and Katz chart ###</span>
            <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.3265</span><span class="p">,</span>
                <span class="o">-</span><span class="mf">1.07</span><span class="p">,</span>
                <span class="o">-</span><span class="mf">0.5339</span><span class="p">,</span>
                 <span class="mf">0.01569</span><span class="p">,</span>
                <span class="o">-</span><span class="mf">0.05165</span><span class="p">,</span>
                 <span class="mf">0.5475</span><span class="p">,</span>
                <span class="o">-</span><span class="mf">0.7361</span><span class="p">,</span>
                 <span class="mf">0.1844</span><span class="p">,</span>
                 <span class="mf">0.1056</span><span class="p">,</span>
                 <span class="mf">0.6134</span><span class="p">,</span>
                 <span class="mf">0.721</span><span class="p">]</span>

            <span class="n">t2</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">tpr</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">tpr</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
                 <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">tpr</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">tpr</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span>

            <span class="n">t3</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">tpr</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">/</span> <span class="n">tpr</span>
            <span class="n">t4</span> <span class="o">=</span> <span class="o">-</span><span class="n">a</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">/</span> <span class="n">tpr</span><span class="p">)</span>
            <span class="n">t5</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">tpr</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

            <span class="n">r</span> <span class="o">=</span> <span class="mf">0.27</span> <span class="o">*</span> <span class="n">ppr</span> <span class="o">/</span> <span class="n">tpr</span>
            <span class="n">z</span> <span class="o">=</span> <span class="mf">0.27</span> <span class="o">*</span> <span class="n">ppr</span> <span class="o">/</span> <span class="n">tpr</span> <span class="o">/</span> <span class="n">r</span>

            <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="n">counter</span> <span class="o">&lt;=</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">diff</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">5</span><span class="p">:</span>
                <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">f</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="p">(</span><span class="n">tpr</span> <span class="o">+</span> <span class="n">t2</span> <span class="o">*</span> <span class="n">r</span> <span class="o">+</span> <span class="n">t3</span> <span class="o">*</span> <span class="n">r</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">t4</span> <span class="o">*</span> <span class="n">r</span> <span class="o">**</span> <span class="mi">5</span> <span class="o">+</span> \
                    <span class="n">t5</span> <span class="o">*</span> <span class="n">r</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> \
                    <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="n">r</span> <span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="mf">0.27</span> <span class="o">*</span> <span class="n">ppr</span>

                <span class="n">fp</span> <span class="o">=</span> <span class="n">tpr</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">t2</span> <span class="o">*</span> <span class="n">r</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">t3</span> <span class="o">*</span> <span class="n">r</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> \
                     <span class="mi">6</span> <span class="o">*</span> <span class="n">t4</span> <span class="o">*</span> <span class="n">r</span> <span class="o">**</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">t5</span> <span class="o">*</span> <span class="n">r</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> \
                     <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="n">r</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> \
                     <span class="p">(</span><span class="mi">3</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="n">r</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="n">r</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>

                <span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">-</span> <span class="n">f</span><span class="o">/</span><span class="n">fp</span>
                <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="p">(</span><span class="mf">0.27</span> <span class="o">*</span> <span class="n">ppr</span> <span class="o">/</span> <span class="n">tpr</span> <span class="o">/</span> <span class="n">r</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="n">z</span> <span class="o">=</span> <span class="mf">0.27</span> <span class="o">*</span> <span class="n">ppr</span> <span class="o">/</span> <span class="n">tpr</span> <span class="o">/</span> <span class="n">r</span>

            <span class="c1">### gas compressiblity from Dranchuk and Abau-Kassem ###</span>
            <span class="n">cpr</span> <span class="o">=</span> <span class="n">tpr</span> <span class="o">*</span> <span class="n">z</span> <span class="o">/</span> <span class="n">ppr</span> <span class="o">/</span> <span class="n">fp</span>
            <span class="n">cg</span> <span class="o">=</span> <span class="n">cpr</span> <span class="o">/</span> <span class="n">ppc</span>

            <span class="c1">### gas expansion factor ###</span>
            <span class="n">bg</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0282793</span> <span class="o">*</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="n">form_temp</span> <span class="o">+</span> <span class="mf">459.67</span><span class="p">))</span> <span class="o">/</span> <span class="n">pore_press</span>

            <span class="c1">### gas density Eq 1.64 GRE ###</span>
            <span class="n">rho_hc</span> <span class="o">=</span> <span class="mf">1.495</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">pore_press</span> <span class="o">*</span> <span class="p">(</span><span class="n">gas_grav</span><span class="p">))</span> <span class="o">/</span> \
                     <span class="p">(</span><span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="n">form_temp</span> <span class="o">+</span> <span class="mf">459.67</span><span class="p">))</span>
            <span class="n">nphi_hc</span> <span class="o">=</span> <span class="mf">2.17</span> <span class="o">*</span> <span class="n">rho_hc</span>

            <span class="c1">### gas viscosity Lee Gonzalez Eakin method ###</span>
            <span class="c1">### Eqs. 1.63-1.67 GRE ###</span>
            <span class="n">k</span> <span class="o">=</span> <span class="p">((</span><span class="mf">9.379</span> <span class="o">+</span> <span class="mf">0.01607</span> <span class="o">*</span> <span class="p">(</span><span class="mf">28.9625</span> <span class="o">*</span> <span class="n">gas_grav</span><span class="p">))</span> <span class="o">*</span> \
                              <span class="p">(</span><span class="n">form_temp</span> <span class="o">+</span> <span class="mf">459.67</span><span class="p">)</span> <span class="o">**</span> <span class="mf">1.5</span><span class="p">)</span> <span class="o">/</span> \
                              <span class="p">(</span><span class="mf">209.2</span> <span class="o">+</span> <span class="mf">19.26</span> <span class="o">*</span> <span class="p">(</span><span class="mf">28.9625</span> <span class="o">*</span> <span class="n">gas_grav</span><span class="p">)</span> <span class="o">+</span> \
                              <span class="p">(</span><span class="n">form_temp</span> <span class="o">+</span> <span class="mf">459.67</span><span class="p">))</span>

            <span class="n">x</span> <span class="o">=</span> <span class="mf">3.448</span> <span class="o">+</span> <span class="mf">986.4</span> <span class="o">/</span> \
                <span class="p">(</span><span class="n">form_temp</span> <span class="o">+</span> <span class="mf">459.67</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.01009</span> <span class="o">*</span> <span class="p">(</span><span class="mf">28.9625</span> <span class="o">*</span> <span class="n">gas_grav</span><span class="p">)</span>

            <span class="n">y</span> <span class="o">=</span> <span class="mf">2.447</span> <span class="o">-</span> <span class="mf">0.2224</span> <span class="o">*</span> <span class="n">x</span>
            <span class="n">mu_hc</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**-</span><span class="mi">4</span> <span class="o">*</span> <span class="n">k</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">rho_hc</span> <span class="o">**</span> <span class="n">y</span><span class="p">)</span>


        <span class="c1">### oil reservoir ###</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="c1"># Normalize gas gravity to separator pressure of 100 psi</span>
            <span class="n">ygs100</span> <span class="o">=</span> <span class="n">gas_grav</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">5.912</span> <span class="o">*</span> <span class="mf">0.00001</span> <span class="o">*</span> <span class="n">oil_api</span> <span class="o">*</span> \
                            <span class="p">(</span><span class="n">t_sep</span> <span class="o">-</span> <span class="mf">459.67</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">p_sep</span> <span class="o">/</span> <span class="mf">114.7</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">oil_api</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rs</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">rs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">rs</span> <span class="o">=</span> <span class="mf">0.0362</span> <span class="o">*</span> <span class="n">ygs100</span> <span class="o">*</span> <span class="n">pore_press</span> <span class="o">**</span> <span class="mf">1.0937</span> <span class="o">*</span> \
                      <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="mf">25.724</span> <span class="o">*</span> <span class="n">oil_api</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">form_temp</span> <span class="o">+</span> <span class="mf">459.67</span><span class="p">))</span>

                <span class="n">bp</span> <span class="o">=</span> <span class="p">((</span><span class="mf">56.18</span> <span class="o">*</span> <span class="n">rs</span> <span class="o">/</span> <span class="n">ygs100</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> \
                 <span class="p">(</span><span class="o">-</span><span class="mf">10.393</span> <span class="o">*</span> <span class="n">oil_api</span> <span class="o">/</span> <span class="p">(</span><span class="n">form_temp</span> <span class="o">+</span> <span class="mf">459.67</span><span class="p">)))</span> <span class="o">**</span> <span class="mf">0.84246</span>
                <span class="c1">### gas saturated bubble-point ###</span>
                <span class="n">bo</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mf">4.677</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">4</span> <span class="o">*</span> <span class="n">rs</span> <span class="o">+</span> <span class="mf">1.751</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">5</span> <span class="o">*</span> \
                              <span class="p">(</span><span class="n">form_temp</span> <span class="o">-</span> <span class="mi">60</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">oil_api</span> <span class="o">/</span> <span class="n">ygs100</span><span class="p">)</span> <span class="o">-</span> \
                              <span class="mf">1.811</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">8</span> <span class="o">*</span> <span class="n">rs</span> <span class="o">*</span> \
                              <span class="p">(</span><span class="n">form_temp</span> <span class="o">-</span> <span class="mi">60</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">oil_api</span> <span class="o">/</span> <span class="n">ygs100</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rs</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">rs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">rs</span> <span class="o">=</span> <span class="mf">0.0178</span> <span class="o">*</span> <span class="n">ygs100</span> <span class="o">*</span> <span class="n">pore_press</span> <span class="o">**</span> <span class="mf">1.187</span> <span class="o">*</span> \
                      <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="mf">23.931</span> <span class="o">*</span> <span class="n">oil_api</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">form_temp</span> <span class="o">+</span> <span class="mf">459.67</span><span class="p">))</span>

                <span class="n">bp</span> <span class="o">=</span> <span class="p">((</span><span class="mf">56.18</span> <span class="o">*</span> <span class="n">rs</span> <span class="o">/</span> <span class="n">ygs100</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> \
                 <span class="p">(</span><span class="o">-</span><span class="mf">10.393</span> <span class="o">*</span> <span class="n">oil_api</span> <span class="o">/</span> <span class="p">(</span><span class="n">form_temp</span> <span class="o">+</span> <span class="mf">459.67</span><span class="p">)))</span> <span class="o">**</span> <span class="mf">0.84246</span>

                <span class="c1">### gas saturated bubble-point ###</span>
                <span class="n">bo</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mf">4.670</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">4</span> <span class="o">*</span> <span class="n">rs</span> <span class="o">+</span> <span class="mf">1.1</span> <span class="o">*</span> \
                   <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">5</span> <span class="o">*</span> <span class="p">(</span><span class="n">form_temp</span> <span class="o">-</span> <span class="mi">60</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">oil_api</span> <span class="o">/</span> <span class="n">ygs100</span><span class="p">)</span> <span class="o">+</span> \
                   <span class="mf">1.337</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">9</span> <span class="o">*</span> <span class="n">rs</span> <span class="o">*</span> <span class="p">(</span><span class="n">form_temp</span> <span class="o">-</span> <span class="mi">60</span><span class="p">)</span> <span class="o">*</span> \
                   <span class="p">(</span><span class="n">oil_api</span> <span class="o">/</span> <span class="n">ygs100</span><span class="p">)</span>

            <span class="c1">### calculate bo for undersaturated oil ###</span>
            <span class="n">pp_gt_bp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pore_press</span> <span class="o">&gt;</span> <span class="n">bp</span> <span class="o">+</span> <span class="mi">100</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pp_gt_bp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">bo</span><span class="p">[</span><span class="n">pp_gt_bp</span><span class="p">]</span> <span class="o">=</span> <span class="n">bo</span><span class="p">[</span><span class="n">pp_gt_bp</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mf">0.00001</span> <span class="o">*</span> \
                       <span class="p">(</span><span class="o">-</span><span class="mi">1433</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">rs</span> <span class="o">+</span> <span class="mf">17.2</span> <span class="o">*</span> <span class="n">form_temp</span><span class="p">[</span><span class="n">pp_gt_bp</span><span class="p">]</span> <span class="o">-</span> \
                        <span class="mi">1180</span> <span class="o">*</span> <span class="n">ygs100</span> <span class="o">+</span> <span class="mf">12.61</span> <span class="o">*</span> <span class="n">oil_api</span><span class="p">))</span> <span class="o">*</span> \
                        <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pore_press</span><span class="p">[</span><span class="n">pp_gt_bp</span><span class="p">]</span> <span class="o">/</span> <span class="n">bp</span><span class="p">[</span><span class="n">pp_gt_bp</span><span class="p">]))</span>

            <span class="c1">### oil properties ###</span>
            <span class="n">rho_hc</span> <span class="o">=</span> <span class="p">(((</span><span class="mf">141.5</span> <span class="o">/</span> <span class="p">(</span><span class="n">oil_api</span> <span class="o">+</span> <span class="mf">131.5</span><span class="p">)</span> <span class="o">*</span> <span class="mf">62.428</span><span class="p">)</span> <span class="o">+</span> \
                       <span class="mf">0.0136</span> <span class="o">*</span> <span class="n">rs</span> <span class="o">*</span><span class="n">ygs100</span><span class="p">)</span> <span class="o">/</span> <span class="n">bo</span><span class="p">)</span> <span class="o">/</span> <span class="mf">62.428</span>
            <span class="n">nphi_hc</span> <span class="o">=</span> <span class="mf">1.003</span> <span class="o">*</span> <span class="n">rho_hc</span>

            <span class="c1">### oil viscosity from Beggs-Robinson ###</span>
            <span class="c1">### RE Handbook Eqs. 2.121 ###</span>
            <span class="n">muod</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">6.9824</span> <span class="o">-</span> <span class="mf">0.04658</span> <span class="o">*</span> <span class="n">oil_api</span><span class="p">)</span> <span class="o">*</span>\
                          <span class="n">form_temp</span> <span class="o">**</span> <span class="o">-</span><span class="mf">1.163</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="n">mu_hc</span> <span class="o">=</span> <span class="p">(</span><span class="mf">10.715</span> <span class="o">*</span> <span class="p">(</span><span class="n">rs</span> <span class="o">+</span> <span class="mi">100</span><span class="p">)</span> <span class="o">**</span> <span class="o">-</span><span class="mf">0.515</span><span class="p">)</span> <span class="o">*</span> \
                     <span class="n">muod</span> <span class="o">**</span> <span class="p">(</span><span class="mf">5.44</span> <span class="o">*</span> <span class="p">(</span><span class="n">rs</span> <span class="o">+</span> <span class="mi">150</span><span class="p">)</span> <span class="o">**</span> <span class="o">-</span><span class="mf">0.338</span><span class="p">)</span>

            <span class="c1">### undersaturated oil viscosity from Vasquez and Beggs ###</span>
            <span class="c1">### Eqs. 2.123 ###</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pp_gt_bp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">mu_hc</span><span class="p">[</span><span class="n">pp_gt_bp</span><span class="p">]</span> <span class="o">=</span> <span class="n">mu_hc</span><span class="p">[</span><span class="n">pp_gt_bp</span><span class="p">]</span> <span class="o">*</span> \
                          <span class="p">(</span><span class="n">pore_press</span><span class="p">[</span><span class="n">pp_gt_bp</span><span class="p">]</span> <span class="o">/</span> <span class="n">bp</span><span class="p">[</span><span class="n">pp_gt_bp</span><span class="p">])</span> <span class="o">**</span> \
                          <span class="p">(</span><span class="mf">2.6</span> <span class="o">*</span> <span class="n">pore_press</span><span class="p">[</span><span class="n">pp_gt_bp</span><span class="p">]</span> <span class="o">**</span> <span class="mf">1.187</span> <span class="o">*</span> \
                          <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.000039</span> <span class="o">*</span> <span class="n">pore_press</span><span class="p">[</span><span class="n">pp_gt_bp</span><span class="p">]</span> <span class="o">-</span> <span class="mi">5</span><span class="p">))</span>

        <span class="n">output_curves</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;PORE_PRESS&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">pore_press</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span><span class="s1">&#39;psi&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Calculated Pore Pressure&#39;</span><span class="p">},</span>

            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;RES_TEMP&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">form_temp</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Calculated Reservoir Temperature&#39;</span><span class="p">},</span>

            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;NES&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">nes</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;psi&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Calculated Net Effective Stress&#39;</span><span class="p">},</span>

            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;RW&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">rw</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;ohmm&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Calculated Resistivity Water&#39;</span><span class="p">},</span>

            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;RMF&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">rmf</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;ohmm&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Calculated Resistivity Mud Filtrate&#39;</span><span class="p">},</span>

            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;RHO_HC&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">rho_hc</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;g/cc&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Calculated Density of Hydrocarbon&#39;</span><span class="p">},</span>

            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;RHO_W&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">rho_w</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;g/cc&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Calculated Density of Water&#39;</span><span class="p">},</span>

            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;RHO_MF&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">rho_mf</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;g/cc&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Calculated Density of Mud Filtrate&#39;</span><span class="p">},</span>

            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;NPHI_HC&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">nphi_hc</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;v/v&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Calculated Neutron Log Response of Hydrocarbon&#39;</span><span class="p">},</span>

            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;NPHI_W&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">nphi_w</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;v/v&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Calculated Neutron Log Response of Water&#39;</span><span class="p">},</span>

            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;NPHI_MF&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">nphi_mf</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;v/v&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span><span class="s1">&#39;Calculated Neutron Log Response of Mud Filtrate&#39;</span><span class="p">},</span>

            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;MU_HC&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">mu_hc</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;cP&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Calculated Viscosity of Hydrocarbon&#39;</span><span class="p">}</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">curve</span> <span class="ow">in</span> <span class="n">output_curves</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">curve</span><span class="p">[</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">]][</span><span class="n">depth_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">data</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">data</span><span class="p">[</span><span class="n">depth_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
                <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_curve</span><span class="p">(</span><span class="n">curve</span><span class="p">[</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">],</span> <span class="n">data</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span>
                          <span class="n">unit</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">],</span> <span class="n">descr</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;descr&#39;</span><span class="p">])</span>

        <span class="c1">### gas curves ###</span>
        <span class="k">if</span> <span class="n">oil_api</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gas_curves</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">z</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Calcualted Real Gas Z Factor&#39;</span><span class="p">},</span>

                <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;CG&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">cg</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;1 / psi&#39;</span><span class="p">,</span>
                <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Calculated Gas Compressibility&#39;</span><span class="p">},</span>

                <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;BG&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">bg</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Calculated Gas Formation Volume Factor&#39;</span><span class="p">}</span>
            <span class="p">]</span>

            <span class="k">for</span> <span class="n">curve</span> <span class="ow">in</span> <span class="n">gas_curves</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">curve</span><span class="p">[</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">]][</span><span class="n">depth_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="n">data</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">depth_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
                    <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_curve</span><span class="p">(</span><span class="n">curve</span><span class="p">[</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">],</span>
                                  <span class="n">data</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span>
                                  <span class="n">unit</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">],</span>
                                  <span class="n">descr</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;descr&#39;</span><span class="p">])</span>

        <span class="c1">### oil curves ###</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">oil_curves</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;BO&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">bo</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Calculated Oil Formation Volume Factor&#39;</span><span class="p">},</span>

                <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;BP&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">bp</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;psi&#39;</span><span class="p">,</span>
                <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Calcualted Bubble Point&#39;</span><span class="p">}</span>
            <span class="p">]</span>

            <span class="k">for</span> <span class="n">curve</span> <span class="ow">in</span> <span class="n">oil_curves</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">curve</span><span class="p">[</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">]][</span><span class="n">depth_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="n">data</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">depth_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
                    <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_curve</span><span class="p">(</span><span class="n">curve</span><span class="p">[</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">],</span>
                                   <span class="n">data</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span>
                                   <span class="n">unit</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">],</span>
                                   <span class="n">descr</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;descr&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="Log.formation_fluid_properties"><a class="viewcode-back" href="../../class/Log.html#petropy.Log.formation_fluid_properties">[docs]</a>    <span class="k">def</span> <span class="nf">formation_fluid_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formations</span><span class="p">,</span>
                                   <span class="n">parameter</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate fluid properties over formations with preloaded</span>
<span class="sd">        paramters</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        formations : list</span>
<span class="sd">            list of formations to calculate fluid properties over</span>
<span class="sd">        parameter : str (default &#39;default&#39;)</span>
<span class="sd">            name of parameter to use for fluid properties parameter</span>
<span class="sd">            settings loaded in method</span>
<span class="sd">            fluid_properties_parameters_from_csv</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import petropy as ptr</span>
<span class="sd">        # reads sample Wolfcamp Log from las file</span>
<span class="sd">        &gt;&gt;&gt; log = ptr.log_data(&#39;WFMP&#39;)</span>
<span class="sd">        # loads sample parameters provided</span>
<span class="sd">        &gt;&gt;&gt; log.fluid_properties_parameters_from_csv()</span>
<span class="sd">        # define formations to run</span>
<span class="sd">        &gt;&gt;&gt; f = [&#39;WFMPA&#39;, &#39;WFMPB&#39;, &#39;WFMPC&#39;]</span>
<span class="sd">        # use WFMP parameters for formations from f</span>
<span class="sd">        &gt;&gt;&gt; log.formation_fluid_properties(f, parameter = &#39;WFMP&#39;)</span>


<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`petropy.Log.fluid_properties`</span>
<span class="sd">            calculates fluid properties of log</span>
<span class="sd">        :meth:`petropy.Log.fluid_properties_parameters_from_csv`</span>
<span class="sd">            loads fluid properties parameters</span>
<span class="sd">        :meth:`petropy.Log.tops_from_csv`</span>
<span class="sd">            loads tops of log from csv</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">form</span> <span class="ow">in</span> <span class="n">formations</span><span class="p">:</span>
            <span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tops</span><span class="p">[</span><span class="n">form</span><span class="p">]</span>
            <span class="n">bottom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_formation_depth</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>

            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluid_properties_parameters</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">fluid_properties</span><span class="p">(</span><span class="n">top</span> <span class="o">=</span> <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="n">bottom</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="Log.multimineral_parameters_from_csv"><a class="viewcode-back" href="../../class/Log.html#petropy.Log.multimineral_parameters_from_csv">[docs]</a>    <span class="k">def</span> <span class="nf">multimineral_parameters_from_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">csv_path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads parameters from a csv for input into the multimineral</span>
<span class="sd">        model.</span>

<span class="sd">        This method reads the file located at the csv_path and turns</span>
<span class="sd">        the values into dictionaries to be used as inputs into the</span>
<span class="sd">        multimineral method.</span>

<span class="sd">        This link_ contains a sample csv file with default</span>
<span class="sd">        multimineral properties data.</span>

<span class="sd">        .. _link: ../_static/multimineral_parameters.csv</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            csv_path : str (default None)</span>
<span class="sd">                Path to csv file to read.</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        CSV file must contain header row with the following properties</span>
<span class="sd">        for the multimineral_model</span>

<span class="sd">            gr_matrix : float (default 10)</span>
<span class="sd">                Gamma Ray response of clean (non-clay) matrix</span>
<span class="sd">            nphi_matrix : float (default 0)</span>
<span class="sd">                Neutron response of clean (non-clay) matrix</span>
<span class="sd">            gr_clay : float (default 450)</span>
<span class="sd">                Gamma Ray response of pure clay matrix</span>
<span class="sd">            rho_clay : float (default 2.64)</span>
<span class="sd">                Density of pure clay matrix</span>
<span class="sd">            nphi_clay : float (default 0.65)</span>
<span class="sd">                Neutron reponse of pure clay matrix</span>
<span class="sd">            pe_clay : float (default 4)</span>
<span class="sd">                Photoelectric response of pure clay matrix</span>
<span class="sd">            rma : float (default 180)</span>
<span class="sd">                Resistivity of clean tight matrix</span>
<span class="sd">            rt_clay : float (default 80)</span>
<span class="sd">                Resistivity for inorganic shale matrix</span>
<span class="sd">            vclay_linear_weight : float (default 1)</span>
<span class="sd">                Weight of liner clay volume</span>
<span class="sd">            vclay_clavier_weight : float (defaul 0.5)</span>
<span class="sd">                Weight of Clavier clay volume</span>
<span class="sd">            vclay_larionov_weight : float (defaul 0.5)</span>
<span class="sd">                Weight of Larionov clay volume</span>
<span class="sd">            vclay_nphi_weight : float (default 1)</span>
<span class="sd">                Weight of Neutron clay volume</span>
<span class="sd">            vclay_nphi_rhob_weight : float (default 1)</span>
<span class="sd">                Weight of Neutron Density clay volume</span>
<span class="sd">            vclay_cutoff : float (default 0.05)</span>
<span class="sd">                Cutoff for oranics calculation.</span>
<span class="sd">                If vclay &lt; vclay_cutoff then toc = 0</span>
<span class="sd">            rho_om : float (default 1.15)</span>
<span class="sd">                Density of organic matter</span>
<span class="sd">            nphi_om : float (default 0.6)</span>
<span class="sd">                Neutron response of pure organic matter</span>
<span class="sd">            pe_om : float (default 0.2)</span>
<span class="sd">                Photoelectric response of pure organic matter</span>
<span class="sd">            ro : float (default 1.6)</span>
<span class="sd">                Vitronite reflectance of organic matter</span>
<span class="sd">            lang_press : float (default 670)</span>
<span class="sd">                Langmiur pressure for gas adsorption on organics in psi</span>
<span class="sd">            passey_nphi_weight : float (default 1)</span>
<span class="sd">                Weight for Passey nphi toc</span>
<span class="sd">            passey_rhob_weight : float (default 1)</span>
<span class="sd">                Weight for Passey rhob toc</span>
<span class="sd">            passey_lom : float (default 10)</span>
<span class="sd">                Passey level of organic maturity</span>
<span class="sd">            passey_baseline_res : float (default 40)</span>
<span class="sd">                Passey inorganic baseline resistivity</span>
<span class="sd">            passey_baseline_rhob : float (default 2.65)</span>
<span class="sd">                Passey inorganic baseline density</span>
<span class="sd">            passey_baseline_nphi : float (default 0)</span>
<span class="sd">                Passey inorganic baseline neutron</span>
<span class="sd">            schmoker_weight : float (default 1)</span>
<span class="sd">                Weight for Schmoker toc</span>
<span class="sd">            schmoker_slope : float (default 0.7257)</span>
<span class="sd">                Slope for schmoker density to toc correlation</span>
<span class="sd">            schmoker_baseline_rhob : float (default 2.6)</span>
<span class="sd">                Density cutoff for schmoker toc correlation</span>
<span class="sd">            rho_pyr : float (default 5)</span>
<span class="sd">                Density of pyrite</span>
<span class="sd">            nphi_pyr : float (default 0.13)</span>
<span class="sd">                Neutron response of pure pyrite</span>
<span class="sd">            pe_pyr : float (default 13)</span>
<span class="sd">                Photoelectric response of pure pyrite</span>
<span class="sd">            om_pyrite_slope : float (default 0.2)</span>
<span class="sd">                Slope correlating pyrite volume to organic matter</span>
<span class="sd">            include_qtz : str {&#39;YES&#39;, &#39;NO&#39;} (default &#39;YES&#39;)</span>
<span class="sd">                Toggle to include or exclude qtz.</span>
<span class="sd">                &#39;YES&#39; to include. &#39;NO&#39; to exclude.</span>
<span class="sd">            rho_qtz : float (default 2.65)</span>
<span class="sd">                Density of quartz</span>
<span class="sd">            nphi_qtz : float (default -0.04)</span>
<span class="sd">                Neutron response for pure quartz</span>
<span class="sd">            pe_qtz : float (default 1.81)</span>
<span class="sd">                Photoelectric response for pure quartz</span>
<span class="sd">            include_clc : str {&#39;YES&#39;, &#39;NO&#39;} (default &#39;YES&#39;)</span>
<span class="sd">                Toggle to include or exclude clc.</span>
<span class="sd">                &#39;YES&#39; to include. &#39;NO&#39; to exclude.</span>
<span class="sd">            rho_clc : float (default 2.71)</span>
<span class="sd">                Density of calcite</span>
<span class="sd">            nphi_clc : float (default 0)</span>
<span class="sd">                Neutron response for pure calcite</span>
<span class="sd">            pe_clc : float (default 5.08)</span>
<span class="sd">                Photoelectric response for pure calcite</span>
<span class="sd">            include_dol : str {&#39;YES&#39;, &#39;NO&#39;} (default &#39;YES&#39;)</span>
<span class="sd">                Toggle to include or exclude dol.</span>
<span class="sd">                &#39;YES&#39; to include. &#39;NO&#39; to exclude.</span>
<span class="sd">            rho_dol : float (default 2.85)</span>
<span class="sd">                Density of dolomite</span>
<span class="sd">            nphi_dol : float (default 0.04)</span>
<span class="sd">                Neutron response to dolomite</span>
<span class="sd">            pe_dol : float (default 3.14)</span>
<span class="sd">                Photoelectric response to dolomite</span>
<span class="sd">            include_x : str {&#39;YES&#39;, &#39;NO&#39;} (default &#39;NO&#39;)</span>
<span class="sd">                Toggle to include or exclude exotic mineral, x.</span>
<span class="sd">                &#39;YES&#39; to include. &#39;NO&#39; to exclude.</span>
<span class="sd">            name_x : str (default &#39;Gypsum&#39;)</span>
<span class="sd">                Name of exotic mineral, x.</span>
<span class="sd">            name_log_x : str (default &#39;GYP&#39;)</span>
<span class="sd">                Log name of exotic mineral, x</span>
<span class="sd">            rho_x : float (default 2.35)</span>
<span class="sd">                Density of exotic mineral, x</span>
<span class="sd">            nphi_x : float (default 0.507)</span>
<span class="sd">                Neutron response of exotic mineral, x</span>
<span class="sd">            pe_x : float (default 4.04)</span>
<span class="sd">                Photoelectric respone of exotic mineral, x</span>
<span class="sd">            pe_fl : float (default 0)</span>
<span class="sd">                Photoelectric response of reservoir fluid.</span>
<span class="sd">            m : float (default 2)</span>
<span class="sd">                Cementation exponent</span>
<span class="sd">            n : float (default 2)</span>
<span class="sd">                Saturation exponent</span>
<span class="sd">            a : float (default 1)</span>
<span class="sd">                Cementation constant</span>
<span class="sd">            cec : float (default -1)</span>
<span class="sd">                Cation Exchange Capaticy for use in Waxman Smits Sw</span>
<span class="sd">                equation. If cec = -1, correlation equation is used to</span>
<span class="sd">                calculate cec.</span>
<span class="sd">            archie_weight : float (default 0)</span>
<span class="sd">                Weight for archie Sw</span>
<span class="sd">            indonesia_weight : float (default 1)</span>
<span class="sd">                Weight for Indonesia Sw</span>
<span class="sd">            simandoux_weight : float (default 0)</span>
<span class="sd">                Weight for Simandoux Sw</span>
<span class="sd">            modified_simandoux_weight : float (default 0)</span>
<span class="sd">                Weight for Modified Simandoux Sw</span>
<span class="sd">            waxman_smits_weight : float (default 0)</span>
<span class="sd">                Weight for Waxman Smits Sw</span>
<span class="sd">            buckles_parameter : float (default -1)</span>
<span class="sd">                Buckles parameter for calculating irreducible water</span>
<span class="sd">                saturation. If less than 0, it is calculated using a</span>
<span class="sd">                correlation.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import petropy as ptr</span>
<span class="sd">        # reads sample Wolfcamp Log from las file</span>
<span class="sd">        &gt;&gt;&gt; log = ptr.log_data(&#39;WFMP&#39;)</span>
<span class="sd">        # loads base parameters</span>
<span class="sd">        &gt;&gt;&gt; log.multimineral_parameters_from_csv()</span>

<span class="sd">        &gt;&gt;&gt; import petropy as ptr</span>
<span class="sd">        # reads sample Wolfcamp Log from las file</span>
<span class="sd">        &gt;&gt;&gt; log = ptr.log_data(&#39;WFMP&#39;)</span>
<span class="sd">        # define path to csv file</span>
<span class="sd">        &gt;&gt;&gt; my_csv_paramters = &#39;path/to/csv/file.csv&#39;</span>
<span class="sd">        # loads specified parameters</span>
<span class="sd">        &gt;&gt;&gt; log.multimineral_parameters_from_csv(my_csv_paramters)</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`petropy.Log.fluid_properties`</span>
<span class="sd">            Calculates fluid properties using input settings loaded</span>
<span class="sd">            through this method</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">csv_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">local_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
            <span class="n">csv_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;multimineral_parameters.csv&#39;</span><span class="p">)</span>

        <span class="n">param_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span>
        <span class="n">param_df</span> <span class="o">=</span> <span class="n">param_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">multimineral_parameters</span><span class="o">=</span><span class="n">param_df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span> <span class="o">=</span> <span class="s1">&#39;index&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Log.multimineral_model"><a class="viewcode-back" href="../../class/Log.html#petropy.Log.multimineral_model">[docs]</a>    <span class="k">def</span> <span class="nf">multimineral_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">gr_matrix</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">nphi_matrix</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">gr_clay</span> <span class="o">=</span> <span class="mi">350</span><span class="p">,</span> <span class="n">rho_clay</span> <span class="o">=</span> <span class="mf">2.64</span><span class="p">,</span>
    <span class="n">nphi_clay</span> <span class="o">=</span> <span class="mf">0.65</span><span class="p">,</span> <span class="n">pe_clay</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">rma</span> <span class="o">=</span> <span class="mi">180</span><span class="p">,</span> <span class="n">rt_clay</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span>
    <span class="n">vclay_linear_weight</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">vclay_clavier_weight</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">vclay_larionov_weight</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">vclay_nphi_weight</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">vclay_nphi_rhob_weight</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">vclay_cutoff</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">rho_om</span> <span class="o">=</span> <span class="mf">1.15</span><span class="p">,</span>
    <span class="n">nphi_om</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span> <span class="n">pe_om</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">ro</span> <span class="o">=</span> <span class="mf">1.6</span><span class="p">,</span> <span class="n">lang_press</span> <span class="o">=</span> <span class="mi">670</span><span class="p">,</span>
    <span class="n">passey_nphi_weight</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">passey_rhob_weight</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">passey_lom</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">passey_baseline_res</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span> <span class="n">passey_baseline_rhob</span> <span class="o">=</span> <span class="mf">2.65</span><span class="p">,</span>
    <span class="n">passey_baseline_nphi</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">schmoker_weight</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">schmoker_slope</span> <span class="o">=</span>  <span class="mf">0.7257</span><span class="p">,</span> <span class="n">schmoker_baseline_rhob</span> <span class="o">=</span> <span class="mf">2.6</span><span class="p">,</span>
    <span class="n">rho_pyr</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">nphi_pyr</span> <span class="o">=</span> <span class="mf">0.13</span><span class="p">,</span> <span class="n">pe_pyr</span> <span class="o">=</span> <span class="mi">13</span><span class="p">,</span> <span class="n">om_pyrite_slope</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
    <span class="n">include_qtz</span> <span class="o">=</span> <span class="s1">&#39;YES&#39;</span><span class="p">,</span> <span class="n">rho_qtz</span> <span class="o">=</span> <span class="mf">2.65</span><span class="p">,</span> <span class="n">nphi_qtz</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.04</span><span class="p">,</span>
    <span class="n">pe_qtz</span> <span class="o">=</span> <span class="mf">1.81</span><span class="p">,</span> <span class="n">include_clc</span> <span class="o">=</span> <span class="s1">&#39;YES&#39;</span><span class="p">,</span> <span class="n">rho_clc</span> <span class="o">=</span> <span class="mf">1.71</span><span class="p">,</span> <span class="n">nphi_clc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">pe_clc</span> <span class="o">=</span> <span class="mf">5.08</span><span class="p">,</span> <span class="n">include_dol</span> <span class="o">=</span> <span class="s1">&#39;YES&#39;</span><span class="p">,</span> <span class="n">rho_dol</span> <span class="o">=</span> <span class="mf">2.85</span><span class="p">,</span>
    <span class="n">nphi_dol</span> <span class="o">=</span> <span class="mf">0.04</span><span class="p">,</span> <span class="n">pe_dol</span> <span class="o">=</span> <span class="mf">3.14</span><span class="p">,</span> <span class="n">include_x</span> <span class="o">=</span> <span class="s1">&#39;NO&#39;</span><span class="p">,</span>
    <span class="n">name_x</span> <span class="o">=</span> <span class="s1">&#39;Gypsum&#39;</span><span class="p">,</span> <span class="n">name_log_x</span> <span class="o">=</span> <span class="s1">&#39;GYP&#39;</span><span class="p">,</span> <span class="n">rho_x</span> <span class="o">=</span> <span class="mf">2.35</span><span class="p">,</span>
    <span class="n">nphi_x</span> <span class="o">=</span> <span class="mf">0.507</span><span class="p">,</span> <span class="n">pe_x</span> <span class="o">=</span> <span class="mf">4.04</span><span class="p">,</span> <span class="n">pe_fl</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">archie_weight</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">indonesia_weight</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">simandoux_weight</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">modified_simandoux_weight</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">waxman_smits_weight</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cec</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">buckles_parameter</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates a petrophysical lithology and porosity model for</span>
<span class="sd">        conventional and unconventional reservoirs. For each depth, the</span>
<span class="sd">        method iterates in a 4 step loop until convergence.</span>

<span class="sd">        **1. Calculate Clay Volume**</span>

<span class="sd">        Clay volume is calculated using a weighted method. Five</span>
<span class="sd">        different equations are available</span>

<span class="sd">        I. Linear</span>

<span class="sd">        .. math::</span>

<span class="sd">            gr\_index &amp;= \\frac{GR_LOG - gr\_matrix}</span>
<span class="sd">                               {gr\_clay - gr_matrix}</span>

<span class="sd">            VCLAY &amp;= gr\_index</span>

<span class="sd">        II. Clavier</span>

<span class="sd">        .. math::</span>

<span class="sd">            VCLAY = 1.7 - \sqrt{3.38 - (gr\_index + 0.7)^2}</span>

<span class="sd">        III. Larionov Tertiary Rocks</span>

<span class="sd">        .. math::</span>

<span class="sd">            VCLAY = 0.083 * (2^{3.7 * gr\_index} - 1)</span>

<span class="sd">        IV. Neutron</span>
<span class="sd">        Calculate apparent nuetron log without organic matter, nphia.</span>

<span class="sd">        .. math::</span>

<span class="sd">            nphia = NPHI\_LOG + (nphi\_matrix - nphi\_om) * vom</span>

<span class="sd">        Calculate vclay using neutron</span>

<span class="sd">        .. math::</span>

<span class="sd">            VCLAY = \\frac{nphia - nphi\_matrix}</span>
<span class="sd">                          {nphi\_clay - nphi\_matrix}</span>

<span class="sd">        V. Neutron Density</span>

<span class="sd">        Calculate apprent density log without organic mater, rhoba.</span>

<span class="sd">        .. math::</span>

<span class="sd">            rhoba = RHOB\_LOG + (rhom - rho\_om) * vom</span>

<span class="sd">        Calculate vclay using neutron density</span>

<span class="sd">        .. math::</span>

<span class="sd">            m1 &amp;= \\frac{nphi\_fl - nphi\_matrix}{rho\_fl - rhom} \\\\</span>
<span class="sd">            x1 &amp;= nphi + m1 * (rhom - rhoba) \\\\</span>
<span class="sd">            x2 &amp;= nphi\_clay + m1 * (rhom - rhoba) \\\\</span>
<span class="sd">            VCLAY &amp;= \\frac{x1 - nphi\_matrix}{x2 - nphi\_matrix} \\\\</span>


<span class="sd">        First, the clay volume of the resepective euqations are</span>
<span class="sd">        calculated. They are then weighted with the vclay_weight.</span>
<span class="sd">        For example, if vclay_weight for every method is 1, then the</span>
<span class="sd">        final vclay is the average of the four equations. To use a</span>
<span class="sd">        single method, set :code:`vclay_method_weight = 1` and all</span>
<span class="sd">        other :code:`vclay_weight = 0`.</span>

<span class="sd">        **2. Calculate Total Organic Carbon And Pyrite**</span>

<span class="sd">        TOC is calculated use a weighted method like vclay with three</span>
<span class="sd">        available equations:</span>

<span class="sd">        I. Schomker&#39;s Density Correlation</span>

<span class="sd">        .. math::</span>

<span class="sd">            TOC = schmoker\_slope*(schmoker\_baseline\_rhob-RHOB\_LOG)</span>

<span class="sd">        II. Passey&#39;s Nuetron Delta Log R</span>

<span class="sd">        .. math::</span>

<span class="sd">            dlr &amp;= 10^{\\frac{RESDEEP\_LOG}{passey\_baseline\_res}} +</span>
<span class="sd">                4 * (NPHI\_LOG - passey\_baseline\_nphi)</span>

<span class="sd">            TOC&amp;=\\frac{dlr\_nphi * 10^{2.297 - 0.1688 * passey\_lom}}</span>
<span class="sd">                       {100}</span>

<span class="sd">        III. Passey&#39;s Density Delta Log R</span>

<span class="sd">        .. math::</span>

<span class="sd">            dlr &amp;= 10^{\\frac{RESDEEP\_LOG}{passey\_baseline\_res}} -</span>
<span class="sd">                2.5 * (RHOB\_LOG - passey\_baseline\_rhob)</span>

<span class="sd">            TOC&amp;=\\frac{dlr\_nphi * 10^{2.297 - 0.1688 * passey\_lom}}</span>
<span class="sd">                       {100}</span>

<span class="sd">        For conventional reservoirs without organics,</span>
<span class="sd">        set :code:`vclay_cutoff = 1`.</span>

<span class="sd">        **3. Calculate Minerals And Porosity**</span>

<span class="sd">        Non-negative least squares is used to find the remaining</span>
<span class="sd">        minerals according to the method described in Chapter 4 of</span>
<span class="sd">        Doveton&#39;s Principles of Mathematical Petrophysics.</span>

<span class="sd">        .. math::</span>

<span class="sd">            V = C^{-1} L</span>

<span class="sd">        Pure mineral log responses are required. For example, quartz</span>
<span class="sd">        would have the input:</span>
<span class="sd">        ::</span>

<span class="sd">            include_qtz = &#39;YES&#39;</span>
<span class="sd">            rho_qtz = 2.65</span>
<span class="sd">            nphi_qtz = -0.04</span>
<span class="sd">            pe_qtz = 1.81</span>

<span class="sd">        An option to include exotic minerals is by specifiying the</span>
<span class="sd">        density, neutron, and pe response of mineral &#39;X&#39;. For example,</span>
<span class="sd">        to add gypsum, use these parameters:</span>
<span class="sd">        ::</span>

<span class="sd">            include_x = &#39;YES&#39;</span>
<span class="sd">            name_x = &#39;Gypsum&#39;</span>
<span class="sd">            name_log_x = &#39;GYP&#39;</span>
<span class="sd">            rho_x = 2.35</span>
<span class="sd">            nphi_x = 0.507</span>
<span class="sd">            pe_x = 4.04</span>

<span class="sd">        To exclude minerals because they are not present or essentially</span>
<span class="sd">        not present in the reservoir, set the include parameter to</span>
<span class="sd">        &#39;NO&#39;. For example, to exclude dolomite:</span>
<span class="sd">        ::</span>

<span class="sd">            include_dol = &#39;NO&#39;</span>

<span class="sd">        4. Calculate Saturations</span>

<span class="sd">        Saturation is calculated using a weighted method like vclay and</span>
<span class="sd">        toc. To use a single equation set equation_weight = 1 and all</span>
<span class="sd">        other equation_weight = 0. For example, to use only the</span>
<span class="sd">        Indonesia equation set parameters to:</span>
<span class="sd">        ::</span>

<span class="sd">            archie_weight = 0</span>
<span class="sd">            simandoux_weight = 0</span>
<span class="sd">            modified_simandoux_weight = 0</span>
<span class="sd">            indonesia_weight = 1</span>
<span class="sd">            waxman_smits_weight = 0</span>

<span class="sd">        Five saturation equations are available</span>

<span class="sd">        I. Archie</span>

<span class="sd">        .. math::</span>

<span class="sd">            SW=\left(\\frac{a \\times RW\_LOG}</span>
<span class="sd">                           {RESDEEP\_LOG \\times phie^m}</span>
<span class="sd">                \\right)^{\\frac{1}{n}}</span>

<span class="sd">        II. Simandoux</span>

<span class="sd">        .. math::</span>

<span class="sd">            c &amp;= \\frac{(1 - vclay) \\times a \\times RESDEEP\_LOG}</span>
<span class="sd">                       {phie^m}</span>

<span class="sd">            d &amp;= \\frac{c \\times vclay}{2 \\times rt\_clay}</span>

<span class="sd">            e &amp;= \\frac{c}{RESDEEP\_LOG}</span>

<span class="sd">            SW &amp;= ((d^2 + e)^2 - d)^{\\frac{2}{n}}</span>

<span class="sd">        III. Modified Simandoux</span>

<span class="sd">        IV. Indonesia (Poupon-Leveaux)</span>

<span class="sd">        .. math::</span>

<span class="sd">            f &amp;= \sqrt{\\frac{phie^m}{RESDEEP\_LOG}} \\\\</span>
<span class="sd">            g &amp;= \sqrt{\\frac{vclay^{2 - vclay}}{rt\_clay}} \\\\</span>
<span class="sd">            SW &amp;= ((f + g)^2 * RESDEEP\_LOG)^{\\frac{-1}{n}}</span>

<span class="sd">        V. Waxman And Smits</span>

<span class="sd">        CEC</span>
<span class="sd">            if cec &lt;= 0</span>

<span class="sd">            .. math::</span>

<span class="sd">                cec = 10^{1.9832 \\times vclay - 2.4473}</span>

<span class="sd">            else</span>
<span class="sd">                use input cec</span>

<span class="sd">        SW</span>

<span class="sd">        .. math::</span>

<span class="sd">            rw77&amp;=RESDEEP\_LOG * \\frac{reservoir\_temperature + 6.8}</span>
<span class="sd">                                       {83.8}</span>

<span class="sd">            b &amp;= 4.6 * (1 - 0.6 \\times e^{\\frac{-0.77}{rw77}})</span>

<span class="sd">            f &amp;= \\frac{a}{phie^m}</span>

<span class="sd">            qv &amp;= \\frac{cec (1 - phie) rhom}{phie}</span>

<span class="sd">            SW &amp;= 0.5 * \left((-b \\times qv \\times rw77) +</span>
<span class="sd">                  \sqrt{(b \\times qv \\times rw77)^2 +</span>
<span class="sd">                  \\frac{4 * f * rw}{RESDEEP\_LOG}}</span>
<span class="sd">                  \\right)^{\\frac{2}{n}}</span>

<span class="sd">        **4. Update Fluid Properties**</span>

<span class="sd">        .. math::</span>

<span class="sd">            rho\_fl &amp;= RHO\_W \\times Sw + RHO\_HC \\times (1 - Sw)</span>

<span class="sd">            nphi\_fl &amp;= NPHI\_W \\times Sw + NPHI\_HC \\times (1 - Sw)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gr_matrix : float (default 10)</span>
<span class="sd">            Gamma Ray response of clean (non-clay) matrix</span>
<span class="sd">        nphi_matrix : float (default 0)</span>
<span class="sd">            Neutron response of clean (non-clay) matrix</span>
<span class="sd">        gr_clay : float (default 450)</span>
<span class="sd">            Gamma Ray response of pure clay matrix</span>
<span class="sd">        rho_clay : float (default 2.64)</span>
<span class="sd">            Density of pure clay matrix</span>
<span class="sd">        nphi_clay : float (default 0.65)</span>
<span class="sd">            Neutron reponse of pure clay matrix</span>
<span class="sd">        pe_clay : float (default 4)</span>
<span class="sd">            Photoelectric response of pure clay matrix</span>
<span class="sd">        rma : float (default 180)</span>
<span class="sd">            Resistivity of clean tight matrix</span>
<span class="sd">        rt_clay : float (default 80)</span>
<span class="sd">            Resistivity for inorganic shale matrix</span>
<span class="sd">        vclay_linear_weight : float (default 1)</span>
<span class="sd">            Weight of liner clay volume</span>
<span class="sd">        vclay_clavier_weight : float (defaul 0.5)</span>
<span class="sd">            Weight of Clavier clay volume</span>
<span class="sd">        vclay_larionov_weight : float (defaul 0.5)</span>
<span class="sd">            Weight of Larionov clay volume</span>
<span class="sd">        vclay_nphi_weight : float (default 1)</span>
<span class="sd">            Weight of Neutron clay volume</span>
<span class="sd">        vclay_nphi_rhob_weight : float (default 1)</span>
<span class="sd">            Weight of Neutron Density clay volume</span>
<span class="sd">        vclay_cutoff : float (default 0.05)</span>
<span class="sd">            Cutoff for oranics calculation.</span>
<span class="sd">            If vclay &lt; vclay_cutoff then toc = 0</span>
<span class="sd">        rho_om : float (default 1.15)</span>
<span class="sd">            Density of organic matter</span>
<span class="sd">        nphi_om : float (default 0.6)</span>
<span class="sd">            Neutron response of pure organic matter</span>
<span class="sd">        pe_om : float (default 0.2)</span>
<span class="sd">            Photoelectric response of pure organic matter</span>
<span class="sd">        ro : float (default 1.6)</span>
<span class="sd">            Vitronite reflectance of organic matter</span>
<span class="sd">        lang_press : float (default 670)</span>
<span class="sd">            Langmiur pressure gas adsorption on organic matter in psi</span>
<span class="sd">        passey_nphi_weight : float (default 1)</span>
<span class="sd">            Weight for Passey nphi toc</span>
<span class="sd">        passey_rhob_weight : float (default 1)</span>
<span class="sd">            Weight for Passey rhob toc</span>
<span class="sd">        passey_lom : float (default 10)</span>
<span class="sd">            Passey level of organic maturity</span>
<span class="sd">        passey_baseline_res : float (default 40)</span>
<span class="sd">            Passey inorganic baseline resistivity</span>
<span class="sd">        passey_baseline_rhob : float (default 2.65)</span>
<span class="sd">            Passey inorganic baseline density</span>
<span class="sd">        passey_baseline_nphi : float (default 0)</span>
<span class="sd">            Passey inorganic baseline neutron</span>
<span class="sd">        schmoker_weight : float (default 1)</span>
<span class="sd">            Weight for Schmoker toc</span>
<span class="sd">        schmoker_slope : float (default 0.7257)</span>
<span class="sd">            Slope for schmoker density to toc correlation</span>
<span class="sd">        schmoker_baseline_rhob : float (default 2.6)</span>
<span class="sd">            Density cutoff for schmoker toc correlation</span>
<span class="sd">        rho_pyr : float (default 5)</span>
<span class="sd">            Density of pyrite</span>
<span class="sd">        nphi_pyr : float (default 0.13)</span>
<span class="sd">            Neutron response of pure pyrite</span>
<span class="sd">        pe_pyr : float (default 13)</span>
<span class="sd">            Photoelectric response of pure pyrite</span>
<span class="sd">        om_pyrite_slope : float (default 0.2)</span>
<span class="sd">            Slope correlating pyrite volume to organic matter</span>
<span class="sd">        include_qtz : str {&#39;YES&#39;, &#39;NO&#39;} (default &#39;YES&#39;)</span>
<span class="sd">            Toggle to include or exclude qtz.</span>
<span class="sd">            &#39;YES&#39; to include. &#39;NO&#39; to exclude.</span>
<span class="sd">        rho_qtz : float (default 2.65)</span>
<span class="sd">            Density of quartz</span>
<span class="sd">        nphi_qtz : float (default -0.04)</span>
<span class="sd">            Neutron response for pure quartz</span>
<span class="sd">        pe_qtz : float (default 1.81)</span>
<span class="sd">            Photoelectric response for pure quartz</span>
<span class="sd">        include_clc : str {&#39;YES&#39;, &#39;NO&#39;} (default &#39;YES&#39;)</span>
<span class="sd">            Toggle to include or exclude clc.</span>
<span class="sd">            &#39;YES&#39; to include. &#39;NO&#39; to exclude.</span>
<span class="sd">        rho_clc : float (default 2.71)</span>
<span class="sd">            Density of calcite</span>
<span class="sd">        nphi_clc : float (default 0)</span>
<span class="sd">            Neutron response for pure calcite</span>
<span class="sd">        pe_clc : float (default 5.08)</span>
<span class="sd">            Photoelectric response for pure calcite</span>
<span class="sd">        include_dol : str {&#39;YES&#39;, &#39;NO&#39;} (default &#39;YES&#39;)</span>
<span class="sd">            Toggle to include or exclude dol.</span>
<span class="sd">            &#39;YES&#39; to include. &#39;NO&#39; to exclude.</span>
<span class="sd">        rho_dol : float (default 2.85)</span>
<span class="sd">            Density of dolomite</span>
<span class="sd">        nphi_dol : float (default 0.04)</span>
<span class="sd">            Neutron response to dolomite</span>
<span class="sd">        pe_dol : float (default 3.14)</span>
<span class="sd">            Photoelectric response to dolomite</span>
<span class="sd">        include_x : str {&#39;YES&#39;, &#39;NO&#39;} (default &#39;NO&#39;)</span>
<span class="sd">            Toggle to include or exclude exotic mineral, x.</span>
<span class="sd">            &#39;YES&#39; to include. &#39;NO&#39; to exclude.</span>
<span class="sd">        name_x : str (default &#39;Gypsum&#39;)</span>
<span class="sd">            Name of exotic mineral, x.</span>
<span class="sd">        name_log_x : str (default &#39;GYP&#39;)</span>
<span class="sd">            Log name of exotic mineral, x</span>
<span class="sd">        rho_x : float (default 2.35)</span>
<span class="sd">            Density of exotic mineral, x</span>
<span class="sd">        nphi_x : float (default 0.507)</span>
<span class="sd">            Neutron response of exotic mineral, x</span>
<span class="sd">        pe_x : float (default 4.04)</span>
<span class="sd">            Photoelectric respone of exotic mineral, x</span>
<span class="sd">        pe_fl : float (default 0)</span>
<span class="sd">            Photoelectric response of reservoir fluid.</span>
<span class="sd">        m : float (default 2)</span>
<span class="sd">            Cementation exponent</span>
<span class="sd">        n : float (default 2)</span>
<span class="sd">            Saturation exponent</span>
<span class="sd">        a : float (default 1)</span>
<span class="sd">            Cementation constant</span>
<span class="sd">        cec : float (default -1)</span>
<span class="sd">            Cation Exchange Capaticy for use in Waxman Smits equation.</span>
<span class="sd">            If cec = -1, correlation equation is used to calculate cec.</span>
<span class="sd">        archie_weight : float (default 0)</span>
<span class="sd">            Weight for archie Sw</span>
<span class="sd">        indonesia_weight : float (default 1)</span>
<span class="sd">            Weight for Indonesia Sw</span>
<span class="sd">        simandoux_weight : float (default 0)</span>
<span class="sd">            Weight for Simandoux Sw</span>
<span class="sd">        modified_simandoux_weight : float (default 0)</span>
<span class="sd">            Weight for Modified Simandoux Sw</span>
<span class="sd">        waxman_smits_weight : float (default 0)</span>
<span class="sd">            Weight for Waxman Smits Sw</span>
<span class="sd">        buckles_parameter : float (default -1)</span>
<span class="sd">            Buckles parameter for calculating irreducible water</span>
<span class="sd">            saturation. If less than 0, it is calculated using a</span>
<span class="sd">            correlation.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If fluid properties curve values are not present in log,</span>
<span class="sd">            then ValueError is raised with incorrect curve requirements</span>

<span class="sd">        ValueError</span>
<span class="sd">            If raw curves GR_N, NPHI_N, RHOB_N, and RESDEEP_N are not</span>
<span class="sd">            present, then ValueError is raised with incorrect curve</span>
<span class="sd">            requirements as raw curve is either not present or</span>
<span class="sd">            precondtioning has not been properly run.</span>

<span class="sd">        ValueError</span>
<span class="sd">            If no formation value factor is found, then ValueError is</span>
<span class="sd">            raised to satisfy the calculation requirements.</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        **VCLAY**</span>

<span class="sd">        Clavier, C., W. Hoyle, and D. Meunier, 1971a, Quantitative</span>
<span class="sd">            interpretation of thermal neutron decay time logs: Part I.</span>
<span class="sd">            Fundamentals and techniques: Journal of Petroleum</span>
<span class="sd">            Technology, 23, 743–755</span>

<span class="sd">        Clavier, C., W. Hoyle, and D. Meunier, 1971b, Quantitative</span>
<span class="sd">            interpretation of thermal neutron decay time logs: Part II.</span>
<span class="sd">            Interpretation example, interpretation accuracy, and</span>
<span class="sd">            timelapse technique: Journal of Petroleum Technology,</span>
<span class="sd">            23, 756–763.</span>

<span class="sd">        Larionov VV (1969).Borehole Radiometry: Moscow, U.S.S.R. Nedra.</span>

<span class="sd">        Nuetron, and Neutron Density taken from presentations.</span>
<span class="sd">        Need publish papers for citation.</span>

<span class="sd">        **TOC**</span>

<span class="sd">        Passey, Q. R., Creaney, S., Kulla, J. B., Moretti, F. J.,</span>
<span class="sd">            Stroud, J. D., 1990, Practical Model for Organic Richness</span>
<span class="sd">            from Porosity and Resistivity Logs, AAPG Bulletin, 74,</span>
<span class="sd">            1777-1794</span>

<span class="sd">        Schmoker, J.W., 1979, Determination of organic content of</span>
<span class="sd">            Appalachian Devonian shales from formation-density logs:</span>
<span class="sd">            American Association of Petroleum Geologists Bulletin,</span>
<span class="sd">            v.63, no.9, p.1504-1509</span>

<span class="sd">        **MATRIX**</span>

<span class="sd">        Doveton, John H. Principles of Mathematical Petrophysics.</span>
<span class="sd">            Oxford: Oxford University Press, 2014.</span>

<span class="sd">        **SATURATIONS**</span>

<span class="sd">        Archie, G.E. 1942. The Electrical Resistivity Log as an Aid in</span>
<span class="sd">            Determining Some Reservoir Characteristics. Trans. of AIME</span>
<span class="sd">            146 (1): 54-62.</span>

<span class="sd">        Bardon, C., and Pied, B.,1969, Formation water saturation in</span>
<span class="sd">            shaly sands: Society of Professional Well Log Analysts 10th</span>
<span class="sd">            Annual Logging Symposium Transactions: Paper Z,19 pp.</span>

<span class="sd">        Poupon, A. and Leveaux, J. 1971. Evaluation of Water</span>
<span class="sd">            Saturations in Shaly Formations. The Log Analyst 12 (4)</span>

<span class="sd">        Simandoux, P., 1963, Dielectricmeasurements on porous media</span>
<span class="sd">            application to the measurement of water saturations: study</span>
<span class="sd">            of the behaviour of argillaceous formations: Revue de</span>
<span class="sd">            l&#39;Institut Francais du Petrole 18, Supplementary Issue,</span>
<span class="sd">            p. 193-215.</span>

<span class="sd">        Waxman, M.H., and L.J.M. Smits, Electrical Conductivity in Oil</span>
<span class="sd">            Bearing Shaly Sands, Society of Petroleum Engineers</span>
<span class="sd">            Journal, June, p.107-122, 1968.</span>


<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">            1. Clay bound water</span>
<span class="sd">                Clay bound water is included as part of the clay volume</span>
<span class="sd">                based on the default nphi_clay = 0.65. To calculate</span>
<span class="sd">                clay bound water seperately, set nphi_clay to clay</span>
<span class="sd">                matrix absent clay bound water, and include appropriate</span>
<span class="sd">                buckles_parameter for bound water saturations.</span>

<span class="sd">            2. Organics</span>
<span class="sd">                No differieniation is made between kerogen and other</span>
<span class="sd">                organic matter.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import petropy as ptr</span>
<span class="sd">        &gt;&gt;&gt; from petropy import datasets</span>
<span class="sd">        # reads sample Wolfcamp Log from las file</span>
<span class="sd">        &gt;&gt;&gt; log = ptr.log_data(&#39;WFMP&#39;)</span>
<span class="sd">        # calculates fluid properties with default settings</span>
<span class="sd">        &gt;&gt;&gt; log.fluid_properties()</span>
<span class="sd">        # calculates multimeral model with default settings</span>
<span class="sd">        &gt;&gt;&gt; log.multimineral_model()</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`petropy.Log.formation_multimineral_model`</span>
<span class="sd">            uses multimineral_model accross formations</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">### check for requirements ###</span>
        <span class="n">required_raw_curves</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GR_N&#39;</span><span class="p">,</span> <span class="s1">&#39;NPHI_N&#39;</span><span class="p">,</span> <span class="s1">&#39;RHOB_N&#39;</span><span class="p">,</span> <span class="s1">&#39;RESDEEP_N&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">curve</span> <span class="ow">in</span> <span class="n">required_raw_curves</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">curve</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Raw curve </span><span class="si">%s</span><span class="s1"> not found and is </span><span class="se">\</span>
<span class="s1">                             required for multimineral_model.&#39;</span> <span class="o">%</span> <span class="n">curve</span><span class="p">)</span>

        <span class="n">required_curves_from_fluid_properties</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RW&#39;</span><span class="p">,</span> <span class="s1">&#39;RHO_HC&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;RHO_W&#39;</span><span class="p">,</span> <span class="s1">&#39;NPHI_HC&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;NPHI_W&#39;</span><span class="p">,</span> <span class="s1">&#39;RES_TEMP&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;NES&#39;</span><span class="p">,</span> <span class="s1">&#39;PORE_PRESS&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">curve</span> <span class="ow">in</span> <span class="n">required_curves_from_fluid_properties</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">curve</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Fluid Properties curve </span><span class="si">%s</span><span class="s1"> not found.</span><span class="se">\</span>
<span class="s1">                     Run fluid_properties before multimineral_model.&#39;</span> \
                     <span class="o">%</span> <span class="n">curve</span><span class="p">)</span>

        <span class="n">all_required_curves</span> <span class="o">=</span> <span class="n">required_raw_curves</span> <span class="o">+</span>\
                              <span class="n">required_curves_from_fluid_properties</span>

        <span class="k">if</span> <span class="s1">&#39;BO&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;BG&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Formation Volume Factor required for </span><span class="se">\</span>
<span class="s1">                      multimineral_model. Run fluid_properties first.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;BO&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">hc_class</span> <span class="o">=</span> <span class="s1">&#39;OIL&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hc_class</span> <span class="o">=</span> <span class="s1">&#39;GAS&#39;</span>

        <span class="k">if</span> <span class="s1">&#39;PE_N&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">use_pe</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">use_pe</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1">### get depths ###</span>
        <span class="k">if</span> <span class="n">top</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">top_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">top_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">top</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">bottom</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bottom_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bottom_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">bottom</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1">### initialize minerals ###</span>
        <span class="k">if</span> <span class="n">include_qtz</span><span class="o">.</span><span class="n">upper</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
            <span class="n">include_qtz</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">include_qtz</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">include_clc</span><span class="o">.</span><span class="n">upper</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
            <span class="n">include_clc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">include_clc</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">include_dol</span><span class="o">.</span><span class="n">upper</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
            <span class="n">include_dol</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">include_dol</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">include_x</span><span class="o">.</span><span class="n">upper</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
            <span class="n">include_x</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">name_log_x</span> <span class="o">=</span> <span class="n">name_log_x</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">include_x</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1">## check for existence of calculated curves ###</span>
        <span class="c1">### add if not found ##</span>
        <span class="n">nulls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">nulls</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="n">output_curves</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;PHIE&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;v/v&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Effective Porosity&#39;</span><span class="p">},</span>

            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;SW&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;v/v&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Water Saturation&#39;</span><span class="p">},</span>

            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;SHC&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;v/v&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Hydrocarbon Saturation&#39;</span><span class="p">},</span>

            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;BVH&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;v/v&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Bulk Volume Hydrocarbon&#39;</span><span class="p">},</span>

            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;BVW&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;v/v&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Bulk Volume Water&#39;</span><span class="p">},</span>

            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;BVWI&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;v/v&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Bulk Volume Water Irreducible&#39;</span><span class="p">},</span>

            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;BVWF&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span>
            <span class="s1">&#39;v/v&#39;</span><span class="p">,</span> <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Bulk Volume Water Free&#39;</span><span class="p">},</span>

            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;BVOM&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;v/v&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Bulk Volume Fraction Organic Matter&#39;</span><span class="p">},</span>

            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;BVCLAY&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span><span class="s1">&#39;v/v&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Bulk Volume Fraction Clay&#39;</span><span class="p">},</span>

            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;BVPYR&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;v/v&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Bulk Volume Fraction Pyrite&#39;</span><span class="p">},</span>

            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;VOM&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;v/v&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Matrix Volume Fraction Organic Matter&#39;</span><span class="p">},</span>

            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;VCLAY&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;v/v&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Matrix Volume Fraction Clay&#39;</span><span class="p">},</span>

            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;VPYR&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;v/v&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Matrix Volume Fraction Pyrite&#39;</span><span class="p">},</span>

            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;RHOM&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;g/cc&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Matrix Density&#39;</span><span class="p">},</span>

            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;TOC&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;wt/wt&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Matrix Weight Fraction Organic Matter&#39;</span><span class="p">},</span>

            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;WTCLAY&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span><span class="s1">&#39;unit&#39;</span><span class="p">:</span><span class="s1">&#39;wt/wt&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Matrix Weight Fraction Clay&#39;</span><span class="p">},</span>

            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;WTPYR&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span><span class="s1">&#39;unit&#39;</span><span class="p">:</span><span class="s1">&#39;wt/wt&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Matrix Weight Fraction Pyrite&#39;</span><span class="p">},</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">curve</span> <span class="ow">in</span> <span class="n">output_curves</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_curve</span><span class="p">(</span><span class="n">curve</span><span class="p">[</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">],</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span>
                               <span class="n">unit</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">],</span>
                               <span class="n">descr</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;descr&#39;</span><span class="p">])</span>

        <span class="n">qtz_curves</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;BVQTZ&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;v/v&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Bulk Volume Fraction Quartz&#39;</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;VQTZ&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;v/v&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Matrix Volume Fraction Quartz&#39;</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;WTQTZ&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span><span class="s1">&#39;unit&#39;</span><span class="p">:</span><span class="s1">&#39;wt/wt&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Matrix Weight Fraction Quartz&#39;</span><span class="p">}</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">include_qtz</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">curve</span> <span class="ow">in</span> <span class="n">qtz_curves</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_curve</span><span class="p">(</span><span class="n">curve</span><span class="p">[</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">],</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span>
                                   <span class="n">unit</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">],</span>
                                   <span class="n">descr</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;descr&#39;</span><span class="p">])</span>

        <span class="n">clc_curves</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;BVCLC&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;v/v&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Bulk Volume Fraction Calcite&#39;</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;VCLC&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;v/v&#39;</span><span class="p">,</span>
             <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Matrix Volume Fraction Calcite&#39;</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;WTCLC&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span><span class="s1">&#39;unit&#39;</span><span class="p">:</span><span class="s1">&#39;wt/wt&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Matrix Weight Fraction Calcite&#39;</span><span class="p">}</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">include_clc</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">curve</span> <span class="ow">in</span> <span class="n">clc_curves</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_curve</span><span class="p">(</span><span class="n">curve</span><span class="p">[</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">],</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span>
                                   <span class="n">unit</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">],</span>
                                   <span class="n">descr</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;descr&#39;</span><span class="p">])</span>

        <span class="n">dol_curves</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;BVDOL&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;v/v&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Bulk Volume Fraction Dolomite&#39;</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;VDOL&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;v/v&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Matrix Volume Fraction Dolomite&#39;</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;WTDOL&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span><span class="s1">&#39;unit&#39;</span><span class="p">:</span><span class="s1">&#39;wt/wt&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Matrix Weight Fraction Dolomite&#39;</span><span class="p">}</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">include_dol</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">curve</span> <span class="ow">in</span> <span class="n">dol_curves</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_curve</span><span class="p">(</span><span class="n">curve</span><span class="p">[</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">],</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span>
                                   <span class="n">unit</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">],</span>
                                   <span class="n">descr</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;descr&#39;</span><span class="p">])</span>

        <span class="n">min_x_curves</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;menmoic&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span> <span class="o">+</span> <span class="n">name_log_x</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span>
            <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;v/v&#39;</span><span class="p">,</span> <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Bulk Volume Fraction &#39;</span> <span class="o">+</span> <span class="n">name_x</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span> <span class="o">+</span> <span class="n">name_log_x</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span>
            <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;v/v&#39;</span><span class="p">,</span> <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Matrix Volume Fraction &#39;</span><span class="o">+</span> <span class="n">name_x</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;WT&#39;</span> <span class="o">+</span> <span class="n">name_log_x</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span>
            <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;wt/wt&#39;</span><span class="p">,</span> <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Matrix Weight Fraction &#39;</span><span class="o">+</span><span class="n">name_x</span><span class="p">}</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">include_x</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">curve</span> <span class="ow">in</span> <span class="n">min_x_curves</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_curve</span><span class="p">(</span><span class="n">curve</span><span class="p">[</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">],</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span>
                                   <span class="n">unit</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">],</span>
                                   <span class="n">descr</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;descr&#39;</span><span class="p">])</span>

        <span class="n">oil_curve</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;OIP&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span>
                     <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;Mmbbl / section&#39;</span><span class="p">,</span> <span class="s1">&#39;descr&#39;</span><span class="p">:</span><span class="s1">&#39;Oil in Place&#39;</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">hc_class</span> <span class="o">==</span> <span class="s1">&#39;OIL&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">oil_curve</span><span class="p">[</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_curve</span><span class="p">(</span><span class="n">oil_curve</span><span class="p">[</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">],</span> <span class="n">oil_curve</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span>
                               <span class="n">unit</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">],</span>
                               <span class="n">descr</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;descr&#39;</span><span class="p">])</span>

        <span class="n">gas_curves</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;GIP&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span>
            <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;BCF / section&#39;</span><span class="p">,</span> <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Gas in Place&#39;</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;GIP_FREE&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span>
            <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;BCF / section&#39;</span><span class="p">,</span> <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Free Gas in Place&#39;</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">:</span> <span class="s1">&#39;GIP_ADS&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nulls</span><span class="p">),</span>
            <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;BCF / section&#39;</span><span class="p">,</span> <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Adsorbed Gas in Place&#39;</span><span class="p">}</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">hc_class</span> <span class="o">==</span> <span class="s1">&#39;GAS&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">curve</span> <span class="ow">in</span> <span class="n">gas_curves</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_curve</span><span class="p">(</span><span class="n">curve</span><span class="p">[</span><span class="s1">&#39;mnemoic&#39;</span><span class="p">],</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span>
                                   <span class="n">unit</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">],</span>
                                   <span class="n">descr</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;descr&#39;</span><span class="p">])</span>

        <span class="c1">### calculations over depths ###</span>
        <span class="n">depth_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">top</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bottom</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">depth_index</span><span class="p">:</span>

            <span class="c1">### check for null values in data, skip if true ###</span>
            <span class="n">nans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">([</span><span class="bp">self</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">all_required_curves</span><span class="p">])</span>
            <span class="n">infs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">([</span><span class="bp">self</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">all_required_curves</span><span class="p">])</span>
            <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">nans</span> <span class="ow">or</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">infs</span><span class="p">:</span> <span class="k">continue</span>

            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sample_rate</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sample_rate</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1">### initial parameters to start iterations ###</span>
            <span class="n">phie</span> <span class="o">=</span> <span class="mf">0.1</span>
            <span class="n">rhom</span> <span class="o">=</span> <span class="mf">2.68</span>
            <span class="n">rho_fl</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">nphi_fl</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">vom</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">bvqtz_prev</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">bvclc_prev</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">bvdol_prev</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">bvx_prev</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">phi_prev</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">bvom_prev</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">bvclay_prev</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">bvpyr_prev</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="n">diff</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">diff</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">3</span> <span class="ow">and</span> <span class="n">counter</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
                <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="c1">### log curves without organics ###</span>
                <span class="n">rhoba</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;RHOB_N&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">rhom</span> <span class="o">-</span> <span class="n">rho_om</span><span class="p">)</span> <span class="o">*</span> <span class="n">vom</span>
                <span class="n">nphia</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;NPHI_N&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">nphi_matrix</span> <span class="o">-</span> <span class="n">nphi_om</span><span class="p">)</span><span class="o">*</span><span class="n">vom</span>

                <span class="c1">### clay solver ###</span>
                <span class="n">gr_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">((</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;GR_N&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">gr_matrix</span><span class="p">)</span> \
                           <span class="o">/</span> <span class="p">(</span><span class="n">gr_clay</span> <span class="o">-</span> <span class="n">gr_matrix</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                <span class="c1">### linear vclay method ###</span>
                <span class="n">vclay_linear</span> <span class="o">=</span> <span class="n">gr_index</span>

                <span class="c1">### Clavier vclay method ###</span>
                <span class="n">vclay_clavier</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mf">1.7</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.38</span> <span class="o">-</span> \
                                          <span class="p">(</span><span class="n">gr_index</span> <span class="o">+</span> <span class="mf">0.7</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                <span class="c1">### larionov vclay method ###</span>
                <span class="n">vclay_larionov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mf">0.083</span> <span class="o">*</span> \
                                     <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="mf">3.7</span> <span class="o">*</span> <span class="n">gr_index</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                <span class="c1"># Neutron vclay method without organic correction</span>
                <span class="n">vclay_nphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">((</span><span class="n">nphia</span> <span class="o">-</span> <span class="n">nphi_matrix</span><span class="p">)</span> <span class="o">/</span> \
                                     <span class="p">(</span><span class="n">nphi_clay</span> <span class="o">-</span> <span class="n">nphi_matrix</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                <span class="c1"># Neutron Density vclay method with organic correction</span>
                <span class="n">m1</span> <span class="o">=</span> <span class="p">(</span><span class="n">nphi_fl</span> <span class="o">-</span> <span class="n">nphi_matrix</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">rho_fl</span> <span class="o">-</span> <span class="n">rhom</span><span class="p">)</span>
                <span class="n">x1</span> <span class="o">=</span> <span class="n">nphia</span> <span class="o">+</span> <span class="n">m1</span> <span class="o">*</span> <span class="p">(</span><span class="n">rhom</span> <span class="o">-</span> <span class="n">rhoba</span><span class="p">)</span>
                <span class="n">x2</span> <span class="o">=</span> <span class="n">nphi_clay</span> <span class="o">+</span> <span class="n">m1</span> <span class="o">*</span> <span class="p">(</span><span class="n">rhom</span> <span class="o">-</span> <span class="n">rho_clay</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">nphi_matrix</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">vclay_nphi_rhob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">((</span><span class="n">x1</span> <span class="o">-</span> <span class="n">nphi_matrix</span><span class="p">)</span> <span class="o">/</span> \
                                              <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">nphi_matrix</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">vclay_nphi_rhob</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="n">vclay_weights_sum</span> <span class="o">=</span> <span class="n">vclay_linear_weight</span> <span class="o">+</span> \
                       <span class="n">vclay_clavier_weight</span> <span class="o">+</span> <span class="n">vclay_larionov_weight</span> <span class="o">+</span> \
                       <span class="n">vclay_nphi_weight</span> <span class="o">+</span> <span class="n">vclay_nphi_rhob_weight</span>

                <span class="n">vclay</span> <span class="o">=</span> <span class="p">(</span><span class="n">vclay_linear_weight</span> <span class="o">*</span> <span class="n">vclay_linear</span> <span class="o">+</span> \
                        <span class="n">vclay_clavier_weight</span> <span class="o">*</span> <span class="n">vclay_clavier</span> <span class="o">+</span> \
                        <span class="n">vclay_larionov_weight</span> <span class="o">*</span> <span class="n">vclay_larionov</span> <span class="o">+</span> \
                        <span class="n">vclay_nphi_weight</span> <span class="o">*</span> <span class="n">vclay_nphi</span> <span class="o">+</span> \
                        <span class="n">vclay_nphi_rhob_weight</span> <span class="o">*</span> <span class="n">vclay_nphi_rhob</span><span class="p">)</span> <span class="o">/</span> \
                        <span class="n">vclay_weights_sum</span>

                <span class="n">vclay</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">vclay</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                <span class="n">bvclay</span> <span class="o">=</span> <span class="n">vclay</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">phie</span><span class="p">)</span>

                <span class="c1">### organics ###</span>
                <span class="k">if</span> <span class="n">vclay</span> <span class="o">&gt;</span> <span class="n">vclay_cutoff</span><span class="p">:</span>

                    <span class="c1">### Passey ###</span>
                    <span class="n">dlr_nphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;RESDEEP_N&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> \
                    <span class="n">passey_baseline_res</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;NPHI_N&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> \
                    <span class="n">passey_baseline_nphi</span><span class="p">)</span>

                    <span class="n">dlr_rhob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;RESDEEP_N&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> \
                    <span class="n">passey_baseline_res</span><span class="p">)</span> <span class="o">-</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;RHOB_N&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> \
                    <span class="n">passey_baseline_rhob</span><span class="p">)</span>

                    <span class="n">toc_nphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">((</span><span class="n">dlr_nphi</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="mf">2.297</span> <span class="o">-</span> \
                                    <span class="mf">0.1688</span> <span class="o">*</span> <span class="n">passey_lom</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                    <span class="n">toc_rhob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">((</span><span class="n">dlr_rhob</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="mf">2.297</span> <span class="o">-</span> \
                                    <span class="mf">0.1688</span> <span class="o">*</span> <span class="n">passey_lom</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                    <span class="c1">### Schmoker ###</span>
                    <span class="n">toc_sch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">schmoker_slope</span> <span class="o">*</span> \
                    <span class="p">(</span><span class="n">schmoker_baseline_rhob</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;RHOB_N&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                    <span class="n">toc_weights</span> <span class="o">=</span> <span class="n">passey_nphi_weight</span> <span class="o">+</span> \
                                  <span class="n">passey_rhob_weight</span> <span class="o">+</span> <span class="n">schmoker_weight</span>

                    <span class="c1">### toc in weight percent ###</span>
                    <span class="n">toc</span> <span class="o">=</span> <span class="p">(</span><span class="n">passey_nphi_weight</span> <span class="o">*</span> <span class="n">toc_nphi</span> <span class="o">+</span> \
                           <span class="n">passey_rhob_weight</span> <span class="o">*</span> <span class="n">toc_rhob</span> <span class="o">+</span> \
                           <span class="n">schmoker_weight</span> <span class="o">*</span> <span class="n">toc_sch</span><span class="p">)</span> <span class="o">/</span> <span class="n">toc_weights</span>

                    <span class="c1">### weight percent to volume percent ###</span>
                    <span class="n">volume_om</span> <span class="o">=</span> <span class="n">toc</span> <span class="o">/</span> <span class="n">rho_om</span>

                    <span class="c1"># matrix density without organic matter</span>
                    <span class="n">rhom_no_om</span> <span class="o">=</span> <span class="p">(</span><span class="n">rhom</span> <span class="o">-</span> <span class="n">toc</span> <span class="o">*</span> <span class="n">rho_om</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">toc</span><span class="p">)</span>

                    <span class="c1"># volume of non-organics</span>
                    <span class="n">volume_else</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">toc</span><span class="p">)</span> <span class="o">/</span> <span class="n">rhom_no_om</span>

                    <span class="n">volume_total</span> <span class="o">=</span> <span class="n">volume_om</span> <span class="o">+</span> <span class="n">volume_else</span>

                    <span class="n">vom</span> <span class="o">=</span> <span class="n">volume_om</span> <span class="o">/</span> <span class="n">volume_total</span>
                    <span class="n">bvom</span> <span class="o">=</span> <span class="n">vom</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">phie</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">toc</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">vom</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">bvom</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="c1">### pyrite correlation with organics ###</span>
                <span class="n">vpyr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">om_pyrite_slope</span> <span class="o">*</span> <span class="n">vom</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">bvpyr</span> <span class="o">=</span> <span class="n">vpyr</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">phie</span><span class="p">)</span>

                <span class="c1">### create C, V, and L matrix for equations in ###</span>
                <span class="c1">### Chapter 4 of ####</span>
                <span class="c1"># Principles of Mathematical Petrophysics by Doveton #</span>

                <span class="c1">### removed effect of clay, organics, and pyrite ###</span>
                <span class="n">volume_unconventional</span> <span class="o">=</span> <span class="n">bvom</span> <span class="o">+</span> <span class="n">bvclay</span> <span class="o">+</span> <span class="n">bvpyr</span>
                <span class="n">rhob_clean</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;RHOB_N&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">rho_om</span> <span class="o">*</span> <span class="n">bvom</span> <span class="o">+</span> \
                              <span class="n">rho_clay</span> <span class="o">*</span> <span class="n">bvclay</span> <span class="o">+</span> <span class="n">rho_pyr</span> <span class="o">*</span> <span class="n">bvpyr</span><span class="p">))</span> <span class="o">/</span> \
                              <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">volume_unconventional</span><span class="p">)</span>

                <span class="n">nphi_clean</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;NPHI_N&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">nphi_om</span> <span class="o">*</span> <span class="n">bvom</span> <span class="o">+</span> \
                              <span class="n">nphi_clay</span><span class="o">*</span><span class="n">bvclay</span> <span class="o">+</span> <span class="n">nphi_pyr</span> <span class="o">*</span> <span class="n">bvpyr</span><span class="p">))</span> <span class="o">/</span> \
                              <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">volume_unconventional</span><span class="p">)</span>

                <span class="n">minerals</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">use_pe</span><span class="p">:</span>
                    <span class="n">pe_clean</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;PE_N&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">pe_om</span> <span class="o">*</span> <span class="n">bvom</span> <span class="o">+</span> \
                                <span class="n">pe_clay</span> <span class="o">*</span> <span class="n">bvclay</span> <span class="o">+</span> <span class="n">pe_pyr</span> <span class="o">*</span> <span class="n">bvpyr</span><span class="p">))</span> <span class="o">/</span> \
                                <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">bvom</span> <span class="o">-</span> <span class="n">bvclay</span> <span class="o">-</span> <span class="n">bvpyr</span><span class="p">)</span>

                    <span class="n">l_clean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">rhob_clean</span><span class="p">,</span> <span class="n">nphi_clean</span><span class="p">,</span>
                                          <span class="n">pe_clean</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

                    <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;RHOB_N&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;NPHI_N&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;PE_N&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="mi">1</span><span class="p">])</span>

                    <span class="n">c_clean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># initialize matrix C</span>

                    <span class="k">if</span> <span class="n">include_qtz</span><span class="p">:</span>
                        <span class="n">minerals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;QTZ&#39;</span><span class="p">)</span>
                        <span class="n">mineral_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">((</span><span class="n">rho_qtz</span><span class="p">,</span> <span class="n">nphi_qtz</span><span class="p">,</span>
                                                     <span class="n">pe_qtz</span><span class="p">))</span>
                        <span class="n">c_clean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">c_clean</span><span class="p">,</span> <span class="n">mineral_matrix</span><span class="p">))</span>

                    <span class="k">if</span> <span class="n">include_clc</span><span class="p">:</span>
                        <span class="n">minerals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;CLC&#39;</span><span class="p">)</span>
                        <span class="n">mineral_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">((</span><span class="n">rho_clc</span><span class="p">,</span> <span class="n">nphi_clc</span><span class="p">,</span>
                                                     <span class="n">pe_clc</span><span class="p">))</span>
                        <span class="n">c_clean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">c_clean</span><span class="p">,</span> <span class="n">mineral_matrix</span><span class="p">))</span>

                    <span class="k">if</span> <span class="n">include_dol</span><span class="p">:</span>
                        <span class="n">minerals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;DOL&#39;</span><span class="p">)</span>
                        <span class="n">mineral_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">((</span><span class="n">rho_dol</span><span class="p">,</span> <span class="n">nphi_dol</span><span class="p">,</span>
                                                     <span class="n">pe_dol</span><span class="p">))</span>
                        <span class="n">c_clean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">c_clean</span><span class="p">,</span> <span class="n">mineral_matrix</span><span class="p">))</span>

                    <span class="k">if</span> <span class="n">include_x</span><span class="p">:</span>
                        <span class="n">minerals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
                        <span class="n">mineral_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">((</span><span class="n">rho_x</span><span class="p">,</span> <span class="n">nphi_x</span><span class="p">,</span>
                                                     <span class="n">pe_x</span><span class="p">))</span>
                        <span class="n">c_clean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">c_clean</span><span class="p">,</span> <span class="n">mineral_matrix</span><span class="p">))</span>

                    <span class="n">fluid_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">((</span><span class="n">rho_fl</span><span class="p">,</span> <span class="n">nphi_fl</span><span class="p">,</span> <span class="n">pe_fl</span><span class="p">))</span>
                    <span class="n">c_clean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">c_clean</span><span class="p">,</span> <span class="n">fluid_matrix</span><span class="p">))</span>
                    <span class="n">minerals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;PHI&#39;</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">l_clean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">rhob_clean</span><span class="p">,</span> <span class="n">nphi_clean</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;RHOB_N&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;NPHI_N&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="mi">1</span><span class="p">])</span>

                    <span class="n">c_clean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span> <span class="c1"># initialize matrix C</span>

                    <span class="k">if</span> <span class="n">include_qtz</span><span class="p">:</span>
                        <span class="n">minerals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;QTZ&#39;</span><span class="p">)</span>
                        <span class="n">mineral_matrix</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">((</span><span class="n">rho_qtz</span><span class="p">,</span> <span class="n">nphi_qtz</span><span class="p">))</span>
                        <span class="n">c_clean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">c_clean</span><span class="p">,</span> <span class="n">mineral_matrix</span><span class="p">))</span>

                    <span class="k">if</span> <span class="n">include_clc</span><span class="p">:</span>
                        <span class="n">minerals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;CLC&#39;</span><span class="p">)</span>
                        <span class="n">mineral_matrix</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">((</span><span class="n">rho_clc</span><span class="p">,</span> <span class="n">nphi_clc</span><span class="p">))</span>
                        <span class="n">c_clean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">c_clean</span><span class="p">,</span> <span class="n">mineral_matrix</span><span class="p">))</span>

                    <span class="k">if</span> <span class="n">include_dol</span><span class="p">:</span>
                        <span class="n">minerals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;DOL&#39;</span><span class="p">)</span>
                        <span class="n">mineral_matrix</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">((</span><span class="n">rho_dol</span><span class="p">,</span> <span class="n">nphi_dol</span><span class="p">))</span>
                        <span class="n">c_clean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">c_clean</span><span class="p">,</span> <span class="n">mineral_matrix</span><span class="p">))</span>

                    <span class="k">if</span> <span class="n">include_x</span><span class="p">:</span>
                        <span class="n">minerals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
                        <span class="n">mineral_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">((</span><span class="n">rho_x</span><span class="p">,</span> <span class="n">nphi_x</span><span class="p">))</span>
                        <span class="n">c_clean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">c_clean</span><span class="p">,</span> <span class="n">mineral_matrix</span><span class="p">))</span>

                    <span class="n">fluid_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">((</span><span class="n">rho_fl</span><span class="p">,</span> <span class="n">nphi_fl</span><span class="p">))</span>
                    <span class="n">c_clean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">c_clean</span><span class="p">,</span> <span class="n">fluid_matrix</span><span class="p">))</span>
                    <span class="n">minerals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;PHI&#39;</span><span class="p">)</span>

                <span class="n">c_clean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">c_clean</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

                <span class="n">c_clean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">c_clean</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">c_clean</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>

                <span class="n">bv_clean</span> <span class="o">=</span> <span class="n">nnls</span><span class="p">(</span><span class="n">c_clean</span><span class="p">,</span> <span class="n">l_clean</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">bvqtz</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">bvclc</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">bvdol</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">bvx</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="n">component_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">bv_clean</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">mineral</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">minerals</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">mineral</span> <span class="o">==</span> <span class="s1">&#39;QTZ&#39;</span><span class="p">:</span>
                        <span class="n">bvqtz</span> <span class="o">=</span> <span class="p">(</span><span class="n">bv_clean</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">/</span> <span class="n">component_sum</span><span class="p">)</span> <span class="o">*</span> \
                                <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">volume_unconventional</span><span class="p">)</span>
                        <span class="n">bv_clean</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">bvqtz</span>
                    <span class="k">if</span> <span class="n">mineral</span> <span class="o">==</span> <span class="s1">&#39;CLC&#39;</span><span class="p">:</span>
                        <span class="n">bvclc</span> <span class="o">=</span> <span class="p">(</span><span class="n">bv_clean</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">/</span> <span class="n">component_sum</span><span class="p">)</span> <span class="o">*</span> \
                                <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">volume_unconventional</span><span class="p">)</span>
                        <span class="n">bv_clean</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">bvclc</span>
                    <span class="k">if</span> <span class="n">mineral</span> <span class="o">==</span> <span class="s1">&#39;DOL&#39;</span><span class="p">:</span>
                        <span class="n">bvdol</span> <span class="o">=</span> <span class="p">(</span><span class="n">bv_clean</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">/</span> <span class="n">component_sum</span><span class="p">)</span> <span class="o">*</span> \
                                <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">volume_unconventional</span><span class="p">)</span>
                        <span class="n">bv_clean</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">bvdol</span>
                    <span class="k">if</span> <span class="n">mineral</span> <span class="o">==</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span>
                        <span class="n">bvx</span> <span class="o">=</span> <span class="p">(</span><span class="n">bv_clean</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">/</span> <span class="n">component_sum</span><span class="p">)</span> <span class="o">*</span> \
                                <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">volume_unconventional</span><span class="p">)</span>
                        <span class="n">bv_clean</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">bvx</span>
                    <span class="k">if</span> <span class="n">mineral</span> <span class="o">==</span> <span class="s1">&#39;PHI&#39;</span><span class="p">:</span>
                        <span class="n">phie</span> <span class="o">=</span> <span class="p">(</span><span class="n">bv_clean</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">/</span> <span class="n">component_sum</span><span class="p">)</span> <span class="o">*</span> \
                                <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">volume_unconventional</span><span class="p">)</span>
                        <span class="n">bv_clean</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">phie</span>

                <span class="k">if</span> <span class="n">use_pe</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">c_clean</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                                    <span class="p">(</span>
                                        <span class="p">(</span><span class="n">rho_om</span><span class="p">,</span> <span class="n">rho_clay</span><span class="p">,</span> <span class="n">rho_pyr</span><span class="p">),</span>
                                        <span class="p">(</span><span class="n">nphi_om</span><span class="p">,</span> <span class="n">nphi_clay</span><span class="p">,</span> <span class="n">nphi_pyr</span><span class="p">),</span>
                                        <span class="p">(</span><span class="n">pe_om</span><span class="p">,</span> <span class="n">pe_clay</span><span class="p">,</span> <span class="n">pe_pyr</span><span class="p">),</span>
                                        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                                    <span class="p">)</span>
                                <span class="p">)</span>
                              <span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">c_clean</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                                    <span class="p">(</span>
                                        <span class="p">(</span><span class="n">rho_om</span><span class="p">,</span> <span class="n">rho_clay</span><span class="p">,</span> <span class="n">rho_pyr</span><span class="p">),</span>
                                        <span class="p">(</span><span class="n">nphi_om</span><span class="p">,</span> <span class="n">nphi_clay</span><span class="p">,</span> <span class="n">nphi_pyr</span><span class="p">),</span>
                                        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                                    <span class="p">)</span>
                              <span class="p">))</span>

                <span class="n">bv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bv_clean</span><span class="p">,</span> <span class="p">(</span><span class="n">bvom</span><span class="p">,</span> <span class="n">bvclay</span><span class="p">,</span> <span class="n">bvpyr</span><span class="p">))</span>

                <span class="n">l_hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">bv</span><span class="p">)</span>

                <span class="n">sse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">((</span><span class="n">l</span> <span class="o">-</span> <span class="n">l_hat</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">l</span> <span class="o">-</span> <span class="n">l_hat</span><span class="p">)</span>

                <span class="n">prev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">((</span><span class="n">bvqtz_prev</span><span class="p">,</span> <span class="n">bvclc_prev</span><span class="p">,</span> <span class="n">bvdol_prev</span><span class="p">,</span>
                                   <span class="n">bvx_prev</span><span class="p">,</span> <span class="n">phi_prev</span><span class="p">,</span> <span class="n">bvom_prev</span><span class="p">,</span>
                                   <span class="n">bvclay_prev</span><span class="p">,</span> <span class="n">bvpyr_prev</span><span class="p">))</span>
                <span class="n">cur</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">((</span><span class="n">bvqtz</span><span class="p">,</span> <span class="n">bvclc</span><span class="p">,</span> <span class="n">bvdol</span><span class="p">,</span> <span class="n">bvx</span><span class="p">,</span> <span class="n">phie</span><span class="p">,</span> <span class="n">bvom</span><span class="p">,</span>
                                  <span class="n">bvclay</span><span class="p">,</span> <span class="n">bvpyr</span><span class="p">))</span>

                <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cur</span> <span class="o">-</span> <span class="n">prev</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

                <span class="n">bvqtz_prev</span> <span class="o">=</span> <span class="n">bvqtz</span>
                <span class="n">bvclc_prev</span> <span class="o">=</span> <span class="n">bvclc</span>
                <span class="n">bvdol_prev</span> <span class="o">=</span> <span class="n">bvdol</span>
                <span class="n">bvx_prev</span> <span class="o">=</span> <span class="n">bvx</span>
                <span class="n">bvom_prev</span> <span class="o">=</span> <span class="n">bvom</span>
                <span class="n">bvclay_prev</span> <span class="o">=</span> <span class="n">bvclay</span>
                <span class="n">bvpyr_prev</span> <span class="o">=</span> <span class="n">bvpyr</span>
                <span class="n">phi_prev</span> <span class="o">=</span> <span class="n">phie</span>

                <span class="n">avg_percent_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">l</span> <span class="o">-</span> <span class="n">l_hat</span><span class="p">)</span> <span class="o">/</span> <span class="n">l</span><span class="p">)</span> <span class="o">*</span><span class="mi">100</span>

                <span class="c1">### calculate matrix volume fraction ###</span>

                <span class="n">per_matrix</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">phie</span>

                <span class="n">vqtz</span> <span class="o">=</span> <span class="n">bvqtz</span> <span class="o">/</span> <span class="n">per_matrix</span>
                <span class="n">vclc</span> <span class="o">=</span> <span class="n">bvclc</span> <span class="o">/</span> <span class="n">per_matrix</span>
                <span class="n">vdol</span> <span class="o">=</span> <span class="n">bvdol</span> <span class="o">/</span> <span class="n">per_matrix</span>
                <span class="n">vx</span> <span class="o">=</span> <span class="n">bvx</span> <span class="o">/</span> <span class="n">per_matrix</span>
                <span class="n">vclay</span> <span class="o">=</span> <span class="n">bvclay</span> <span class="o">/</span> <span class="n">per_matrix</span>
                <span class="n">vom</span> <span class="o">=</span> <span class="n">bvom</span> <span class="o">/</span> <span class="n">per_matrix</span>
                <span class="n">vpyr</span> <span class="o">=</span> <span class="n">bvpyr</span> <span class="o">/</span> <span class="n">per_matrix</span>

        		<span class="c1">### calculate weight fraction ###</span>

                <span class="n">mass_qtz</span> <span class="o">=</span> <span class="n">vqtz</span> <span class="o">*</span> <span class="n">rho_qtz</span>
                <span class="n">mass_clc</span> <span class="o">=</span> <span class="n">vclc</span> <span class="o">*</span> <span class="n">rho_clc</span>
                <span class="n">mass_dol</span> <span class="o">=</span> <span class="n">vdol</span> <span class="o">*</span> <span class="n">rho_dol</span>
                <span class="n">mass_x</span> <span class="o">=</span> <span class="n">vx</span> <span class="o">*</span> <span class="n">rho_x</span>
                <span class="n">mass_om</span> <span class="o">=</span> <span class="n">vom</span> <span class="o">*</span> <span class="n">rho_om</span>
                <span class="n">mass_clay</span> <span class="o">=</span> <span class="n">vclay</span> <span class="o">*</span> <span class="n">rho_clay</span>
                <span class="n">mass_pyr</span> <span class="o">=</span> <span class="n">vpyr</span> <span class="o">*</span> <span class="n">rho_pyr</span>

                <span class="n">rhom</span> <span class="o">=</span> <span class="n">mass_qtz</span> <span class="o">+</span> <span class="n">mass_clc</span> <span class="o">+</span> <span class="n">mass_dol</span> <span class="o">+</span> <span class="n">mass_x</span> <span class="o">+</span> \
                       <span class="n">mass_om</span> <span class="o">+</span><span class="n">mass_clay</span> <span class="o">+</span> <span class="n">mass_pyr</span>

                <span class="n">wtqtz</span> <span class="o">=</span> <span class="n">mass_qtz</span> <span class="o">/</span> <span class="n">rhom</span>
                <span class="n">wtclc</span> <span class="o">=</span> <span class="n">mass_clc</span> <span class="o">/</span> <span class="n">rhom</span>
                <span class="n">wtdol</span> <span class="o">=</span> <span class="n">mass_dol</span> <span class="o">/</span> <span class="n">rhom</span>
                <span class="n">wtx</span> <span class="o">=</span> <span class="n">mass_x</span> <span class="o">/</span> <span class="n">rhom</span>
                <span class="n">wtom</span> <span class="o">=</span> <span class="n">mass_om</span> <span class="o">/</span> <span class="n">rhom</span>
                <span class="n">wtclay</span> <span class="o">=</span> <span class="n">mass_clay</span> <span class="o">/</span> <span class="n">rhom</span>
                <span class="n">wtpyr</span> <span class="o">=</span> <span class="n">mass_pyr</span> <span class="o">/</span> <span class="n">rhom</span>
                <span class="n">toc</span> <span class="o">=</span> <span class="n">wtom</span>

                <span class="c1">### saturations ###</span>

                <span class="c1">### porosity cutoff in case phie =  0 ###</span>
                <span class="k">if</span> <span class="n">phie</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">:</span>
                    <span class="n">phis</span> <span class="o">=</span> <span class="mf">0.001</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">phis</span> <span class="o">=</span> <span class="n">phie</span>

                <span class="c1">### Archie ###</span>
                <span class="n">sw_archie</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(((</span><span class="n">a</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;RW&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> \
                <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;RESDEEP_N&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">phis</span> <span class="o">**</span> <span class="n">m</span><span class="p">)))</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">n</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                <span class="c1">### Indonesia ###</span>
                <span class="n">sw_ind_a</span> <span class="o">=</span> <span class="p">(</span><span class="n">phie</span> <span class="o">**</span> <span class="n">m</span> <span class="o">/</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;RW&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">**</span> <span class="mf">0.5</span>
                <span class="n">sw_ind_b</span> <span class="o">=</span> <span class="p">(</span><span class="n">vclay</span> <span class="o">**</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">-</span> <span class="n">vclay</span><span class="p">)</span> <span class="o">/</span> <span class="n">rt_clay</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
                <span class="n">sw_indonesia</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(((</span><span class="n">sw_ind_a</span> <span class="o">+</span> <span class="n">sw_ind_b</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span> <span class="o">*</span>\
                               <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;RESDEEP_N&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">n</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                <span class="c1">### Simandoux ###</span>
                <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">vclay</span><span class="p">)</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;RW&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">phis</span> <span class="o">**</span> <span class="n">m</span><span class="p">)</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="n">vclay</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">rt_clay</span><span class="p">)</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">c</span> <span class="o">/</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;RESDEEP_N&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="n">sw_simandoux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(((</span><span class="n">d</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">e</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.2</span> <span class="o">-</span> <span class="n">d</span><span class="p">)</span> <span class="o">**</span> \
                                                         <span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="n">n</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                <span class="c1">### modified Simandoux ###</span>
                <span class="n">sw_mod_simd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">((</span><span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;RW&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> \
                                       <span class="n">phis</span> <span class="o">**</span> <span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">4</span> <span class="o">*</span> <span class="n">phis</span> <span class="o">**</span><span class="n">m</span><span class="p">)</span> <span class="o">/</span> \
                             <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;RW&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;RESDEEP_N&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> \
                             <span class="p">(</span><span class="n">vclay</span> <span class="o">/</span> <span class="n">rt_clay</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">-</span> \
                             <span class="n">vclay</span> <span class="o">/</span> <span class="n">rt_clay</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                <span class="c1">### Waxman Smits ###</span>
                <span class="k">if</span> <span class="n">cec</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">cec</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.9832</span> <span class="o">*</span> <span class="n">vclay</span> <span class="o">-</span> <span class="mf">2.4473</span><span class="p">)</span>

                <span class="n">rw77</span> <span class="o">=</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;RESDEEP_N&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;RES_TEMP&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">6.8</span><span class="p">)</span>\
                       <span class="o">/</span> <span class="mf">83.8</span>

                <span class="n">b</span> <span class="o">=</span> <span class="mf">4.6</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.77</span> <span class="o">/</span> <span class="n">rw77</span><span class="p">))</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="p">(</span><span class="n">phis</span> <span class="o">**</span> <span class="n">m</span><span class="p">)</span>
                <span class="n">qv</span> <span class="o">=</span> <span class="n">cec</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">phis</span><span class="p">)</span> <span class="o">*</span> <span class="n">rhom</span> <span class="o">/</span> <span class="n">phis</span>
                <span class="n">sw_waxman_smits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="o">-</span><span class="n">b</span> <span class="o">*</span> <span class="n">qv</span> <span class="o">*</span> <span class="n">rw77</span><span class="p">)</span> <span class="o">+</span> \
                                              <span class="p">((</span><span class="n">b</span> <span class="o">*</span> <span class="n">qv</span> <span class="o">*</span> <span class="n">rw77</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> \
                                              <span class="mi">4</span> <span class="o">*</span> <span class="n">f</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;RW&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> \
                                        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;RESDEEP_N&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> \
                                            <span class="o">**</span> <span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="n">n</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                <span class="c1">### weighted calculation with bv output ###</span>
                <span class="n">weight_saturations</span> <span class="o">=</span> <span class="n">archie_weight</span> <span class="o">+</span> <span class="n">indonesia_weight</span><span class="o">+</span>\
                       <span class="n">simandoux_weight</span> <span class="o">+</span> <span class="n">modified_simandoux_weight</span> <span class="o">+</span> \
                       <span class="n">waxman_smits_weight</span>

                <span class="n">sw</span> <span class="o">=</span> <span class="p">(</span><span class="n">archie_weight</span> <span class="o">*</span> <span class="n">sw_archie</span> <span class="o">+</span> \
                      <span class="n">indonesia_weight</span> <span class="o">*</span> <span class="n">sw_indonesia</span> <span class="o">+</span> \
                      <span class="n">simandoux_weight</span> <span class="o">*</span> <span class="n">sw_simandoux</span> <span class="o">+</span> \
                      <span class="n">modified_simandoux_weight</span> <span class="o">*</span> <span class="n">sw_mod_simd</span> <span class="o">+</span> \
                      <span class="n">waxman_smits_weight</span> <span class="o">*</span> <span class="n">sw_waxman_smits</span><span class="p">)</span> <span class="o">/</span> \
                      <span class="n">weight_saturations</span>

                <span class="n">bvw</span> <span class="o">=</span> <span class="n">phie</span> <span class="o">*</span> <span class="n">sw</span>
                <span class="n">bvh</span> <span class="o">=</span> <span class="n">phie</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">sw</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">hc_class</span> <span class="o">==</span> <span class="s1">&#39;OIL&#39;</span><span class="p">:</span>
                    <span class="n">oip</span> <span class="o">=</span><span class="p">(</span><span class="mi">7758</span> <span class="o">*</span> <span class="mi">640</span> <span class="o">*</span> <span class="n">sample_rate</span> <span class="o">*</span> <span class="n">bvh</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">6</span><span class="p">)</span><span class="o">/</span> \
                           <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;BO&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="c1"># Mmbbl per sample rate</span>

                <span class="k">elif</span> <span class="n">hc_class</span> <span class="o">==</span> <span class="s1">&#39;GAS&#39;</span><span class="p">:</span>
                    <span class="n">langslope</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.08</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;RES_TEMP&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> \
                                 <span class="mi">2</span> <span class="o">*</span> <span class="n">ro</span> <span class="o">+</span> <span class="mf">22.75</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">gas_ads</span> <span class="o">=</span> <span class="n">langslope</span> <span class="o">*</span> <span class="n">vom</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">*</span> \
                    <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;PORE_PRESS&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;PORE_PRESS&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> \
                    <span class="n">lang_press</span><span class="p">))</span>

                    <span class="n">gip_free</span><span class="o">=</span><span class="p">(</span><span class="mi">43560</span><span class="o">*</span> <span class="mi">640</span> <span class="o">*</span> <span class="n">sample_rate</span> <span class="o">*</span> <span class="n">bvh</span> <span class="o">*</span><span class="mi">10</span><span class="o">**</span> <span class="o">-</span><span class="mi">9</span><span class="p">)</span>\
                                <span class="o">/</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;BG&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>   <span class="c1"># BCF per sample rate</span>
                    <span class="n">gip_ads</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1359.7</span> <span class="o">*</span> <span class="mi">640</span> <span class="o">*</span> <span class="n">sample_rate</span> <span class="o">*</span> \
                            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;RHOB_N&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">gas_ads</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">9</span><span class="p">)</span> <span class="o">/</span> \
                            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;BG&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>	<span class="c1"># BCF per sample rate</span>
                    <span class="n">gip</span> <span class="o">=</span> <span class="n">gip_free</span> <span class="o">+</span> <span class="n">gip_ads</span>

                <span class="n">rho_fl</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;RHO_W&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">sw</span> <span class="o">+</span> \
                         <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;RHO_HC&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">sw</span><span class="p">)</span>

                <span class="n">nphi_fl</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;NPHI_W&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">sw</span> <span class="o">+</span> \
                          <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;NPHI_HC&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">sw</span><span class="p">)</span>

            <span class="c1">### save calculations to log ###</span>

            <span class="c1">### bulk volume ###</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;BVOM&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bvom</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;BVCLAY&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bvclay</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;BVPYR&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bvpyr</span>

            <span class="k">if</span> <span class="n">include_qtz</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;BVQTZ&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bvqtz</span>
            <span class="k">if</span> <span class="n">include_clc</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;BVCLC&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bvclc</span>
            <span class="k">if</span> <span class="n">include_dol</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;BVDOL&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bvdol</span>
            <span class="k">if</span> <span class="n">include_x</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;BV&#39;</span> <span class="o">+</span> <span class="n">name_log_x</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bvx</span>

            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;BVH&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bvh</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;BVW&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bvw</span>

            <span class="c1">### porosity and saturations ###</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;PHIE&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">phie</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;SW&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sw</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;SHC&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">sw</span>

            <span class="c1">### mineral volumes ###</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;VOM&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">vom</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;VCLAY&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">vclay</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;VPYR&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">vpyr</span>

            <span class="k">if</span> <span class="n">include_qtz</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;VQTZ&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">vqtz</span>
            <span class="k">if</span> <span class="n">include_clc</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;VCLC&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">vclc</span>
            <span class="k">if</span> <span class="n">include_dol</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;VDOL&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">vdol</span>
            <span class="k">if</span> <span class="n">include_x</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;V&#39;</span> <span class="o">+</span> <span class="n">name_log_x</span><span class="p">]</span> <span class="o">=</span> <span class="n">vx</span>

            <span class="c1">### weight percent ###</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;RHOM&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhom</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;TOC&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">toc</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;WTCLAY&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">wtclay</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;WTPYR&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">wtpyr</span>

            <span class="k">if</span> <span class="n">include_qtz</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;WTQTZ&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">wtqtz</span>
            <span class="k">if</span> <span class="n">include_clc</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;WTCLC&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">wtclc</span>
            <span class="k">if</span> <span class="n">include_dol</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;WTDOL&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">wtdol</span>
            <span class="k">if</span> <span class="n">include_x</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;WT&#39;</span> <span class="o">+</span> <span class="n">name_log_x</span><span class="p">]</span> <span class="o">=</span> <span class="n">wtx</span>

            <span class="c1"># find irreducible water if buckles_parameter is specified</span>
            <span class="k">if</span> <span class="n">buckles_parameter</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sw_irr</span> <span class="o">=</span> <span class="n">buckles_parameter</span> <span class="o">/</span> <span class="p">(</span><span class="n">phie</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">vclay</span><span class="p">))</span>
                <span class="n">bvwi</span> <span class="o">=</span> <span class="n">phie</span> <span class="o">*</span> <span class="n">sw_irr</span>
                <span class="n">bvwf</span> <span class="o">=</span> <span class="n">bvw</span> <span class="o">-</span> <span class="n">bvwi</span>
                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;BVWI&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bvwi</span>
                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;BVWF&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bvwf</span>

            <span class="k">if</span> <span class="n">hc_class</span> <span class="o">==</span> <span class="s1">&#39;OIL&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;OIP&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">oip</span>

            <span class="k">elif</span> <span class="n">hc_class</span> <span class="o">==</span> <span class="s1">&#39;GAS&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;GIP_FREE&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">gip_free</span>
                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;GIP_ADS&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">gip_ads</span>
                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;GIP&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">gip</span>

        <span class="c1">### find irreducible water saturation outside of loop ###</span>
        <span class="c1">### since parameters depend on calculated values ###</span>

        <span class="k">if</span> <span class="n">buckles_parameter</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">buckles_parameter</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;PHIE&#39;</span><span class="p">][</span><span class="n">depth_index</span><span class="p">]</span> <span class="o">*</span> \
                                      <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;SW&#39;</span><span class="p">][</span><span class="n">depth_index</span><span class="p">])</span>

            <span class="n">ir_denom</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;PHIE&#39;</span><span class="p">][</span><span class="n">depth_index</span><span class="p">]</span> <span class="o">/</span> \
                       <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;VCLAY&#39;</span><span class="p">][</span><span class="n">depth_index</span><span class="p">]))</span>
            <span class="n">ir_denom</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ir_denom</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.001</span>
            <span class="n">sw_irr</span> <span class="o">=</span> <span class="n">buckles_parameter</span> <span class="o">/</span> <span class="n">ir_denom</span>

            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;BVWI&#39;</span><span class="p">][</span><span class="n">depth_index</span><span class="p">]</span> <span class="o">=</span> \
                              <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;PHIE&#39;</span><span class="p">][</span><span class="n">depth_index</span><span class="p">]</span> <span class="o">*</span> <span class="n">sw_irr</span>

            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;BVWF&#39;</span><span class="p">][</span><span class="n">depth_index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;BVW&#39;</span><span class="p">][</span><span class="n">depth_index</span><span class="p">]</span> <span class="o">-</span> \
                                        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;BVWI&#39;</span><span class="p">][</span><span class="n">depth_index</span><span class="p">]</span></div>


<div class="viewcode-block" id="Log.formation_multimineral_model"><a class="viewcode-back" href="../../class/Log.html#petropy.Log.formation_multimineral_model">[docs]</a>    <span class="k">def</span> <span class="nf">formation_multimineral_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formations</span><span class="p">,</span>
                                     <span class="n">parameter</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate multimineral model over formations with loaded</span>
<span class="sd">        paramters</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        formations : list</span>
<span class="sd">            list of formations to calculate fluid properties over</span>
<span class="sd">        parameter : str (default &#39;default&#39;)</span>
<span class="sd">            name of parameter to use for fluid properties parameter</span>
<span class="sd">            settings loaded in method</span>
<span class="sd">            fluid_properties_parameters_from_csv</span>


<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import petropy as ptr</span>
<span class="sd">        # reads sample Wolfcamp Log from las file</span>
<span class="sd">        &gt;&gt;&gt; log = ptr.log_data(&#39;WFMP&#39;)</span>
<span class="sd">        &gt;&gt;&gt; f = [&#39;WFMPA&#39;, &#39;WFMPB&#39;, &#39;WFMPC&#39;]</span>
<span class="sd">        # calculates fluid properties for formations</span>
<span class="sd">        # WFMPA, WFMPB, and WFMPC with default settings</span>
<span class="sd">        &gt;&gt;&gt; log.formation_fluid_properties(f)</span>
<span class="sd">        # calculates multimineral model for formations</span>
<span class="sd">        # WFMPA, WFMPB, and WFMPC with default settings</span>
<span class="sd">        &gt;&gt;&gt; log.formation_multimineral_model(f)</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`petropy.Log.multimineral_model`</span>
<span class="sd">            calculates multimineral model from log data</span>
<span class="sd">        :meth:`petropy.Log.multimineral_parameters_from_csv`</span>
<span class="sd">            loads multimineral model parameters</span>
<span class="sd">        :meth:`petropy.Log.tops_from_csv`</span>
<span class="sd">            loads tops of log from csv</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">form</span> <span class="ow">in</span> <span class="n">formations</span><span class="p">:</span>
            <span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tops</span><span class="p">[</span><span class="n">form</span><span class="p">]</span>
            <span class="n">bottom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_formation_depth</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>

            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multimineral_parameters</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">multimineral_model</span><span class="p">(</span><span class="n">top</span> <span class="o">=</span> <span class="n">top</span><span class="p">,</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">bottom</span><span class="p">,</span><span class="o">**</span><span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="Log.add_pay_flag"><a class="viewcode-back" href="../../class/Log.html#petropy.Log.add_pay_flag">[docs]</a>    <span class="k">def</span> <span class="nf">add_pay_flag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formations</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                     <span class="n">less_than_or_equal</span> <span class="o">=</span> <span class="p">[],</span>
                     <span class="n">greater_than_or_equal</span> <span class="o">=</span> <span class="p">[],</span>
                     <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">descr</span> <span class="o">=</span> <span class="s1">&#39;Pay Flag&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add Pay Flag based on curve cutoffs</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        formations : list (default [])</span>
<span class="sd">            list of formations, which must be found in preloaded tops</span>
<span class="sd">        flag : float</span>
<span class="sd">            Numeric value of pay flag. If interval meets pay</span>
<span class="sd">            requirments, then flag value. Else, 0.</span>
<span class="sd">        less_than_or_equal : list (tuples (CURVE, value),default [])</span>
<span class="sd">            pay flag cutoff where interval is flaged if CURVE is less</span>
<span class="sd">            than or equal to value. Must be list of tuples</span>
<span class="sd">        greater_than_or_equal : list (tuples (CURVE,value), default [])</span>
<span class="sd">            pay flag cutoff where interval is flaged if CURVE is</span>
<span class="sd">            greater than or equal to value. Must be list of tuples</span>
<span class="sd">        name : str (default &#39;&#39;)</span>
<span class="sd">            End name of pay flag. Defaults to numeric</span>
<span class="sd">            :code:`PAY_FLAG_1` and increasing values as more pays flags</span>
<span class="sd">            are added.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import petropy as ptr</span>
<span class="sd">        # loads Wolfcamp and adds pay flag</span>
<span class="sd">        # based on resistivity</span>
<span class="sd">        #</span>
<span class="sd">        # reads sample Wolfcamp Log from las file</span>
<span class="sd">        &gt;&gt;&gt; log = ptr.log_data(&#39;WFMP&#39;)</span>
<span class="sd">        # specify play flag if RESDEEP_N is</span>
<span class="sd">        # greather than or equal to 20</span>
<span class="sd">        &gt;&gt;&gt; gtoe = [(&#39;RESDEEP_N&#39;, 20)]</span>
<span class="sd">        # define formations to calculate pay flag</span>
<span class="sd">        &gt;&gt;&gt; f = [&#39;WFMPA&#39;, &#39;WFMPB&#39;, &#39;WFMPC&#39;]</span>
<span class="sd">        # add pay flag over formations</span>
<span class="sd">        &gt;&gt;&gt; log.add_pay_flag(f, greater_than_or_equal=gtoe,name =&#39;RES&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">curve</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="s1">&#39;PAY_FLAG&#39;</span> <span class="ow">in</span> <span class="n">curve</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;PAY_FLAG_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;PAY_FLAG_&#39;</span> <span class="o">+</span> <span class="n">name</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">nulls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">nulls</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_curve</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">nulls</span><span class="p">,</span> <span class="n">descr</span> <span class="o">=</span> <span class="n">descr</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">form</span> <span class="ow">in</span> <span class="n">formations</span><span class="p">:</span>
            <span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tops</span><span class="p">[</span><span class="n">form</span><span class="p">]</span>
            <span class="n">bottom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_formation_depth</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>

            <span class="n">cutoffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">top</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">cutoffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">cutoffs</span><span class="p">,</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">bottom</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">curve</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">less_than_or_equal</span><span class="p">:</span>
                <span class="n">cutoffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">cutoffs</span><span class="p">,</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">curve</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">value</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">curve</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">greater_than_or_equal</span><span class="p">:</span>
                <span class="n">cutoffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">cutoffs</span><span class="p">,</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">curve</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">value</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

            <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">cutoffs</span><span class="p">]</span> <span class="o">=</span> <span class="n">flag</span></div>


<div class="viewcode-block" id="Log.summations"><a class="viewcode-back" href="../../class/Log.html#petropy.Log.summations">[docs]</a>    <span class="k">def</span> <span class="nf">summations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formations</span><span class="p">,</span> <span class="n">curves</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PHIE&#39;</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cumulative summations over formations for given curves.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        formations : list</span>
<span class="sd">            list of formations, which must be found in preloaded tops</span>
<span class="sd">        curves : list (default [&#39;PHIE&#39;])</span>
<span class="sd">            list of curves to calculated cumulative summations.</span>
<span class="sd">            Values in list must curves be present in log.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import petropy as ptr</span>
<span class="sd">        # Sum Oil in Place for Wolfcamp A</span>
<span class="sd">        #</span>
<span class="sd">        # reads sample Wolfcamp Log from las file</span>
<span class="sd">        &gt;&gt;&gt; log = ptr.log_data(&#39;WFMP&#39;)</span>
<span class="sd">        # define formations</span>
<span class="sd">        &gt;&gt;&gt; f = [&#39;WFMPA&#39;, &#39;WFMPB&#39;, &#39;WFMPC&#39;]</span>
<span class="sd">        # calculate fluid properties for formations</span>
<span class="sd">        &gt;&gt;&gt; log.formation_fluid_properties(formations = f)</span>
<span class="sd">        # calculate minerals and saturations for formations</span>
<span class="sd">        &gt;&gt;&gt; log.formation_multimineral_model(formation = f)</span>
<span class="sd">        # run summations for Oil in Place over formations</span>
<span class="sd">        &gt;&gt;&gt; log.summations(formations = f, curves = [&#39;OIP&#39;])</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`petropy.Log.statistics`</span>
<span class="sd">            Calculates statistics over given formations and curves</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">hc_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;OIP&#39;</span><span class="p">,</span> <span class="s1">&#39;GIP&#39;</span><span class="p">,</span> <span class="s1">&#39;GIP_ADS&#39;</span><span class="p">,</span> <span class="s1">&#39;GIP_FREE&#39;</span><span class="p">]</span>
        <span class="n">sample_rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]]),</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="p">))</span>

        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">curves</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">+</span> <span class="s1">&#39;_SUM&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">nulls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">nulls</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">curve</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_curve</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_curve</span><span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="s1">&#39;_SUM&#39;</span><span class="p">,</span><span class="n">nulls</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="n">curve</span><span class="o">.</span><span class="n">unit</span> <span class="o">+</span><span class="s1">&#39; ft&#39;</span><span class="p">,</span>
                               <span class="n">descr</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">descr</span> <span class="o">+</span> <span class="s1">&#39; Summation&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">formations</span><span class="p">:</span>
            <span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tops</span><span class="p">[</span><span class="n">f</span><span class="p">]</span>
            <span class="n">bottom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_formation_depth</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

            <span class="n">depth_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">top</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                         <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bottom</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">curves</span><span class="p">:</span>

                <span class="c1">### include sample rate in summation for ###</span>
                <span class="c1">### non hydrocarbon columns ###</span>
                <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">hc_columns</span><span class="p">:</span>
                    <span class="n">series</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="n">depth_index</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">series</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="n">depth_index</span><span class="p">]</span> <span class="o">*</span> \
                                    <span class="n">sample_rate</span><span class="p">[</span><span class="n">depth_index</span><span class="p">]</span>

                <span class="bp">self</span><span class="p">[</span> <span class="n">c</span> <span class="o">+</span> <span class="s1">&#39;_SUM&#39;</span><span class="p">][</span><span class="n">depth_index</span><span class="p">]</span> <span class="o">=</span> \
                                            <span class="n">series</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>


<div class="viewcode-block" id="Log.statistics"><a class="viewcode-back" href="../../class/Log.html#petropy.Log.statistics">[docs]</a>    <span class="k">def</span> <span class="nf">statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formations</span><span class="p">,</span> <span class="n">curves</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PHIE&#39;</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Curve statistcs for given formations and curves</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        formations : list (default [])</span>
<span class="sd">            list of formations to calculate statistics over. Must be</span>
<span class="sd">            included in preloaded tops</span>
<span class="sd">        curves : list (default [&#39;PHIE&#39;])</span>
<span class="sd">            list of curve to calculate statistics for. Must be</span>
<span class="sd">            included in Log object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        df : DataFrame</span>
<span class="sd">            Returns Mean, Sum, and Standard Deviation for each curve</span>
<span class="sd">            over every formation</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import petropy as ptr</span>
<span class="sd">        # reads sample Wolfcamp Log from las file</span>
<span class="sd">        &gt;&gt;&gt; log = ptr.log_data(&#39;WFMP&#39;)</span>
<span class="sd">        # define formations to calculate statistics</span>
<span class="sd">        &gt;&gt;&gt; f = [&#39;WFMPA&#39;, &#39;WFMPB&#39;, &#39;WFMPC&#39;]</span>
<span class="sd">        # define curves to calculate statistics</span>
<span class="sd">        &gt;&gt;&gt; c = [&#39;GR_N&#39;, &#39;RHOB_N&#39;, NPHI_N&#39;]</span>
<span class="sd">        # calculate statistics</span>
<span class="sd">        &gt;&gt;&gt; stats_df = log.statistics(formations = f, curves = c)</span>
<span class="sd">        &gt;&gt;&gt; print(stats_df)</span>
<span class="sd">        ..FORMATION                   DATETIME GROSS_H  GR_N_MEAN</span>
<span class="sd">        0     WFMPA 2017-09-26 16:04:47.543687   300.5  92.597982</span>
<span class="sd">        1     WFMPB 2017-09-26 16:04:47.543687   396.5  89.953657</span>
<span class="sd">        2     WFMPC 2017-09-26 16:04:47.543687   337.5  75.326230</span>
<span class="sd">        ........GR_N_SUM   RHOB_N_MEAN   RHOB_N_STD   RHOB_N_SUM</span>
<span class="sd">        1    27825.6935      2.503339     0.048434     752.2535</span>
<span class="sd">        2    35666.6250      2.526271     0.051070    1001.6665</span>
<span class="sd">        3    25422.6025      2.539730     0.069945     857.1590</span>
<span class="sd">        ...NPHI_N_MEAN  NPHI_N_STD  NPHI_N_SUM              UWI</span>
<span class="sd">        1     0.208496    0.055684      62.653   42303347740000</span>
<span class="sd">        2     0.219536    0.044894      87.046   42303347740000</span>
<span class="sd">        3     0.198791    0.066487      67.092   42303347740000</span>


<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`petropy.Log.statistics_to_csv`</span>
<span class="sd">            saves statistics to csv file with option to append or</span>
<span class="sd">            overwrite formation values</span>
<span class="sd">        :meth:`petropy.Log.summations`</span>
<span class="sd">            calculate summation curves over a given formation</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">hc_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;OIP&#39;</span><span class="p">,</span> <span class="s1">&#39;GIP&#39;</span><span class="p">,</span> <span class="s1">&#39;GIP_ADS&#39;</span><span class="p">,</span> <span class="s1">&#39;GIP_FREE&#39;</span><span class="p">]</span>
        <span class="n">sample_rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]]),</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                                <span class="p">))</span>

        <span class="n">pay_flags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">curve</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;PAY_FLAG&#39;</span> <span class="ow">in</span> <span class="n">curve</span><span class="p">:</span>
                <span class="n">pay_flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span>

        <span class="n">stats_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">formations</span><span class="p">:</span>

            <span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tops</span><span class="p">[</span><span class="n">f</span><span class="p">]</span>
            <span class="n">bottom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_formation_depth</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">formation_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;DATETIME&#39;</span><span class="p">:</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
                              <span class="s1">&#39;GROSS_H&#39;</span><span class="p">:</span> <span class="n">bottom</span> <span class="o">-</span> <span class="n">top</span><span class="p">}</span>

            <span class="n">depth_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">top</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                         <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bottom</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">curve</span> <span class="ow">in</span> <span class="n">curves</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">curve</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Curve </span><span class="si">%s</span><span class="s1"> not in log curves.&#39;</span> \
                                     <span class="o">%</span> <span class="n">curve</span><span class="p">)</span>

                <span class="n">series</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">curve</span><span class="p">][</span><span class="n">depth_index</span><span class="p">]</span>
                <span class="n">formation_data</span><span class="p">[</span><span class="n">curve</span> <span class="o">+</span> <span class="s1">&#39;_MEAN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">formation_data</span><span class="p">[</span><span class="n">curve</span> <span class="o">+</span> <span class="s1">&#39;_STD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">curve</span> <span class="ow">in</span> <span class="n">hc_columns</span><span class="p">:</span>
                    <span class="n">series_sum</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1">### multiply by step rate for summations ###</span>
                    <span class="n">series_sum</span> <span class="o">=</span> \
                              <span class="p">(</span><span class="n">series</span> <span class="o">*</span> <span class="n">sample_rate</span><span class="p">[</span><span class="n">depth_index</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

                <span class="n">formation_data</span><span class="p">[</span><span class="n">curve</span> <span class="o">+</span> <span class="s1">&#39;_SUM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">series_sum</span>

                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pay_flags</span><span class="p">:</span>
                    <span class="n">pay_depth_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">depth_index</span><span class="p">,</span>
                                              <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

                    <span class="n">pay_series</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">curve</span><span class="p">][</span><span class="n">pay_depth_index</span><span class="p">]</span>

                    <span class="n">formation_data</span><span class="p">[</span><span class="n">curve</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="s1">&#39;_MEAN&#39;</span><span class="p">]</span> <span class="o">=</span> \
                                                      <span class="n">pay_series</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

                    <span class="n">formation_data</span><span class="p">[</span><span class="n">curve</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="s1">&#39;_STD&#39;</span><span class="p">]</span> <span class="o">=</span> \
                                                       <span class="n">pay_series</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">curve</span> <span class="ow">in</span> <span class="n">hc_columns</span><span class="p">:</span>
                        <span class="n">pay_series_sum</span> <span class="o">=</span> <span class="n">pay_series</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1">### multiply by step rate for summations ###</span>
                        <span class="n">pay_series_sum</span> <span class="o">=</span> <span class="p">(</span><span class="n">pay_series</span> <span class="o">*</span> \
                                    <span class="n">sample_rate</span><span class="p">[</span><span class="n">pay_depth_index</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

                    <span class="n">formation_data</span><span class="p">[</span><span class="n">curve</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="s1">&#39;_SUM&#39;</span><span class="p">]</span> <span class="o">=</span> \
                                                         <span class="n">pay_series_sum</span>

            <span class="n">stats_data</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="n">formation_data</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">stats_data</span><span class="p">,</span> <span class="n">orient</span> <span class="o">=</span> <span class="s1">&#39;index&#39;</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;FORMATION&#39;</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;UWI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">well</span><span class="p">[</span><span class="s1">&#39;UWI&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span></div>

<div class="viewcode-block" id="Log.statistics_to_csv"><a class="viewcode-back" href="../../class/Log.html#petropy.Log.statistics_to_csv">[docs]</a>    <span class="k">def</span> <span class="nf">statistics_to_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">replace</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                          <span class="n">formations</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">curves</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PHIE&#39;</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves curve statistcs for given formations and curves to a csv</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file_path : str</span>
<span class="sd">            path to csv file</span>
<span class="sd">        replace : boolean (default False)</span>
<span class="sd">            option to replace uwi, formation statistics if already in</span>
<span class="sd">            csv file</span>
<span class="sd">        formations : list (default [])</span>
<span class="sd">            list of formations to calculate statistics over. Must be</span>
<span class="sd">            included in preloaded tops</span>
<span class="sd">        curves : list (default [&#39;PHIE&#39;])</span>
<span class="sd">            list of curve to calculate statistics.</span>


<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import petropy as ptr</span>
<span class="sd">        # reads sample Wolfcamp Log from las file</span>
<span class="sd">        &gt;&gt;&gt; log = ptr.log_data(&#39;WFMP&#39;)</span>
<span class="sd">        # define formations to calculate</span>
<span class="sd">        # define formations to calculate statistics</span>
<span class="sd">        &gt;&gt;&gt; f = [&#39;WFMPA&#39;, &#39;WFMPB&#39;, &#39;WFMPC&#39;]</span>
<span class="sd">        # define curves to calculate statistics</span>
<span class="sd">        &gt;&gt;&gt; c = [&#39;GR_N&#39;, &#39;RHOB_N&#39;, NPHI_N&#39;]</span>
<span class="sd">        # define path to csv</span>
<span class="sd">        &gt;&gt;&gt; p = &#39;path/to/my/file.csv&#39;</span>
<span class="sd">        # calculate and save statistcs to csv</span>
<span class="sd">        &gt;&gt;&gt; log.statistics_to_csv(p, formations = f, curves = c)</span>


<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`petropy.Log.statistics`</span>
<span class="sd">            calculates statistics and returns a dataframe</span>
<span class="sd">        :meth:`petropy.Log.summations`</span>
<span class="sd">            calculate summation curves over a given formation</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">new_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statistics</span><span class="p">(</span><span class="n">formations</span> <span class="o">=</span> <span class="n">formations</span><span class="p">,</span>
                                 <span class="n">curves</span> <span class="o">=</span> <span class="n">curves</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">prev_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="n">prev_df</span><span class="p">[</span><span class="s1">&#39;UWI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prev_df</span><span class="p">[</span><span class="s1">&#39;UWI&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">prev_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([])</span>

        <span class="k">if</span> <span class="n">replace</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">prev_df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">new_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">drop_indexes</span> <span class="o">=</span> <span class="n">prev_df</span><span class="p">[(</span><span class="n">prev_df</span><span class="o">.</span><span class="n">UWI</span> <span class="o">==</span> <span class="n">row</span><span class="o">.</span><span class="n">UWI</span><span class="p">)</span> <span class="o">&amp;</span> \
                            <span class="p">(</span><span class="n">prev_df</span><span class="o">.</span><span class="n">FORMATION</span> <span class="o">==</span> <span class="n">row</span><span class="o">.</span><span class="n">FORMATION</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span>

                <span class="n">prev_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">drop_indexes</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">new_df</span> <span class="o">=</span> <span class="n">prev_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_df</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_df</span> <span class="o">=</span> <span class="n">prev_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_df</span><span class="p">)</span>

        <span class="n">new_df</span> <span class="o">=</span> <span class="n">new_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;UWI&#39;</span><span class="p">,</span> <span class="s1">&#39;FORMATION&#39;</span><span class="p">])</span>

        <span class="n">new_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></div>

<div class="viewcode-block" id="Log.to_csv"><a class="viewcode-back" href="../../class/Log.html#petropy.Log.to_csv">[docs]</a>    <span class="k">def</span> <span class="nf">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the log DataFrame to a comma-separated values (csv) file.</span>

<span class="sd">        Calls pandas.DataFrame.to_csv which includes these parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path_or_buf : str or file handle (default None)</span>
<span class="sd">            File path or object, if None is provided the result is</span>
<span class="sd">            returned as a string.</span>
<span class="sd">        sep : str (default ‘,’)</span>
<span class="sd">            Field delimiter for the output file.</span>
<span class="sd">        na_rep : str (default ‘’)</span>
<span class="sd">            Missing data representation</span>
<span class="sd">        float_format : str (default None)</span>
<span class="sd">            Format string for floating point numbers</span>
<span class="sd">        columns : sequence, optional</span>
<span class="sd">            Columns to write</span>
<span class="sd">        header : boolean or list of string (default True)</span>
<span class="sd">            Write out column names. If a list of string is given it is</span>
<span class="sd">            assumed to be aliases for the column names</span>
<span class="sd">        index : boolean (default True)</span>
<span class="sd">            Write row names (index)</span>
<span class="sd">        index_label : str or sequence, or False (default None)</span>
<span class="sd">            Column label for index column(s) if desired. If None is</span>
<span class="sd">            given, and header and index are True, then the index names</span>
<span class="sd">            are used. A sequence should be given if the DataFrame uses</span>
<span class="sd">            MultiIndex. If False do not print fields for index names.</span>
<span class="sd">            Use index_label = False for easier importing in R</span>
<span class="sd">        mode : str</span>
<span class="sd">            Python write mode, default &#39;w&#39;</span>
<span class="sd">        encoding : str, optional</span>
<span class="sd">            A string representing the encoding to use in the output</span>
<span class="sd">            file, defaults to &#39;ascii&#39; on Python 2 and &#39;utf-8&#39; on</span>
<span class="sd">            Python 3.</span>
<span class="sd">        compression : str, optional</span>
<span class="sd">            a string representing the compression to use in the output</span>
<span class="sd">            file, allowed values are &#39;gzip&#39;, &#39;bz2&#39;, &#39;xz&#39;, only used</span>
<span class="sd">            when the first argument is a filename</span>
<span class="sd">        line_terminator : str</span>
<span class="sd">            The newline character or character sequence to use in the</span>
<span class="sd">            output file</span>
<span class="sd">        quoting : constant from csv module, optional</span>
<span class="sd">            defaults to csv.QUOTE_MINIMAL. If you have set a</span>
<span class="sd">            float_format then floats are converted to strings and thus</span>
<span class="sd">            csv.QUOTE_NONNUMERIC will treat them as non-numeric</span>
<span class="sd">        quotechar : str with length 1 (default ‘”’)</span>
<span class="sd">            character used to quote fields</span>
<span class="sd">        doublequote : boolean (default True)</span>
<span class="sd">            Control quoting of quotechar inside a field</span>
<span class="sd">        escapechar : str with length 1 (default None)</span>
<span class="sd">            character used to escape sep and quotechar when appropriate</span>
<span class="sd">        chunksize : int (default None)</span>
<span class="sd">            rows to write at a time</span>
<span class="sd">        tupleize_cols : boolean (default False)</span>
<span class="sd">            write multi_index columns as a list of tuples (if True) or</span>
<span class="sd">            new (expanded format) if False)</span>
<span class="sd">        date_format : str (default None)</span>
<span class="sd">            Format string for datetime objects</span>
<span class="sd">        decimal: str (default ‘.’)</span>
<span class="sd">            Character recognized as decimal separator. E.g. use ‘,’ for</span>
<span class="sd">            European data</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import petropy as ptr</span>
<span class="sd">        # Read las file, then write to csv for use in excel</span>
<span class="sd">        #</span>
<span class="sd">        # reads sample Wolfcamp Log from las file</span>
<span class="sd">        &gt;&gt;&gt; log = ptr.log_data(&#39;WFMP&#39;)</span>
<span class="sd">        # define path to save csv</span>
<span class="sd">        &gt;&gt;&gt; file_name = &#39;path/to/save/name_of_file.csv&#39;</span>
<span class="sd">        # save log to csv</span>
<span class="sd">        &gt;&gt;&gt; log.to_csv(path_or_buf = file_name, index = False)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">()</span>
        <span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">well</span><span class="p">[</span><span class="s1">&#39;NULL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Log.write"><a class="viewcode-back" href="../../class/Log.html#petropy.Log.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">version</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">wrap</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
              <span class="n">STRT</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">STOP</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">STEP</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%10.5g</span><span class="s1">&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes to las file, and overwrites if file exisits. Uses parent</span>
<span class="sd">        class LASFile.write method with specified defaults.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file_path : str</span>
<span class="sd">            path to new las file.</span>
<span class="sd">        version : {1.2 or 2} (default 2)</span>
<span class="sd">            Version for las file</span>
<span class="sd">        wrap : {True, Flase, None} (default False)</span>
<span class="sd">            Specify to wrap data. If None, uses setting from when</span>
<span class="sd">            file was read.</span>
<span class="sd">        STRT : float (default None)</span>
<span class="sd">            Optional override to automatic calculation using the first</span>
<span class="sd">            index curve value.</span>
<span class="sd">        STOP : float (default None)</span>
<span class="sd">            Optional override to automatic calculation using the last</span>
<span class="sd">            index curve value.</span>
<span class="sd">        STEP : float (default None)</span>
<span class="sd">            Optional override to automatic calculation using the first</span>
<span class="sd">            step size in the index curve.</span>
<span class="sd">        fmt : str (default &#39;%10.5g&#39;)</span>
<span class="sd">            Format string for numerical data being written to data</span>
<span class="sd">            section.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import petropy as ptr</span>
<span class="sd">        # reads sample Wolfcamp Log from las file</span>
<span class="sd">        &gt;&gt;&gt; log = ptr.log_data(&#39;WFMP&#39;)</span>
<span class="sd">        # define file path to save log</span>
<span class="sd">        &gt;&gt;&gt; p = &#39;path/to/new_file.las&#39;</span>
<span class="sd">        &gt;&gt;&gt; log.write(p)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">Log</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">version</span> <span class="o">=</span> <span class="n">version</span><span class="p">,</span> <span class="n">wrap</span> <span class="o">=</span> <span class="n">wrap</span><span class="p">,</span>
                                   <span class="n">STRT</span> <span class="o">=</span> <span class="n">STRT</span><span class="p">,</span> <span class="n">STOP</span> <span class="o">=</span> <span class="n">STOP</span><span class="p">,</span>
                                   <span class="n">STEP</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fmt</span> <span class="o">=</span> <span class="n">fmt</span><span class="p">)</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">PetroPy</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../class/Log.html">Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class/LogViewer.html">LogViewer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../function/electrofacies.html">Electrofacies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../function/dataset.html">Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../function/download.html">Downloads</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Todd Heitmann.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>